<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="图数据库 Nebula Graph 在 HBaseCon Asia2019 的分享实录"><meta property="twitter:title" content="图数据库 Nebula Graph 在 HBaseCon Asia2019 的分享实录"><meta name=twitter:description content="本文整理自 Nebula Graph 技术总监参加 HBaseCon Asia2019 的演讲。"><meta name=og:description content="本文整理自 Nebula Graph 技术总监参加 HBaseCon Asia2019 的演讲。"><meta name=twitter:image content="/nebula-website/cn/posts/nebula-graph-in-hbasecon-asia-2019/HBase_hu111bab32792900bea659b3d968bcaff3_807592_600x0_resize_box_2.png"><meta name=og:image content="/nebula-website/cn/posts/nebula-graph-in-hbasecon-asia-2019/HBase_hu111bab32792900bea659b3d968bcaff3_807592_600x0_resize_box_2.png"><meta name=description content="本文整理自 Nebula Graph 技术总监参加 HBaseCon Asia2019 的演讲。"><meta name=generator content="Hugo 0.65.3"><title>图数据库 Nebula Graph 在 HBaseCon Asia2019 的分享实录</title><link rel="shortcut icon" href=/nebula-website/favicon.ico><link rel=stylesheet href=/nebula-website/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/nebula-website/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/creative.css type=text/css><link rel=stylesheet href=/nebula-website/css/modals.css type=text/css><link rel=stylesheet href=/nebula-website/css/animate.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/nebula-website/js/jquery.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=container-fluid><div class=navbar-header><div class=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>文档</a></li><li class=active><a href=/cn/posts target>博客</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>论坛</a></li><li><a href=#contact_us target onclick=contactUsClick()>联系我们</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank>Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><section class=blog-content><h1>图数据库 Nebula Graph 在 HBaseCon Asia2019 的分享实录</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>陈恒</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2019-07-28</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/nebula-website/cn//tags/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2>技术演讲</a></div></div><blockquote><p><a href=https://github.com/vesoft-inc/nebula>Nebula Graph</a>：一个开源的分布式图数据库。作为唯一能够存储万亿个带属性的节点和边的在线图数据库，Nebula Graph 不仅能够在高并发场景下满足毫秒级的低时延查询要求，还能够实现服务高可用且保障数据安全性。</p></blockquote><h2 id=本篇导读>本篇导读</h2><p>HBaseCon Asia2019 活动于 2019 年 7 月 20 日于北京金隅喜来登酒店举办，应主办方邀请，Nebula Graph 技术总监-陈恒在活动中发表演讲 “Nebula: A Graph DB based on HBase” 。本篇文章是根据此次演讲所整理出的技术干货，全文阅读需要 30 分钟。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase01.png alt=image></p><p>大家下午好，我是陈恒，来自 VESoft，是开源图数据库 Nebula Graph 的开发者。同时，我也是 HBase 的 Commiter（刚才在后面和各位大佬谈笑风生），今天和大家分享的，是我们最近刚开源的分布式图数据库 Nebula Graph。</p><h2 id=nebula-graph-简要介绍>Nebula Graph 简要介绍</h2><p>首先，介绍一下我们公司：欧若数网科技有限公司（英文名：VESoft），是 2018 年 10 月份成立的。我们的核心产品是分布式图数据库 Nebula Graph，这个项目从开始到现在，大概做了半年多时间。目前已经 release alpha 版本，还有可以试用的 docker，正式的 release 预计会在 10 月份。</p><p>NebulaGraph 是完全开源的，可以在 GitHub 上访问 <a href=https://github.com/vesoft-inc/nebula>https://www.github.com/vesoft-inc/Nebula</a></p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase02.png alt=image></p><h2 id=nosql-类数据库的发展趋势>NoSQL 类数据库的发展趋势</h2><p>下面我们看一张图，是 DB-Engine 的统计，反映了从 2013 年到今年所有的 NoSQL 类数据库的发展趋势。横轴代表的是时间，纵轴可以认为是受众程度，或者社区里的讨论热烈程度。大家可以看到绿色的线就是图数据库。这些年一共翻了十倍，增长还是非常迅猛的。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase03.png alt=image></p><h2 id=图数据库的简要介绍>图数据库的简要介绍</h2><p>在座的同事是 HBase 专家，部分可能对于图数据库有些不太了解，我这里简单介绍一下图数据库。它的主要应用场景其实是针对于各种各样的点和边组成的数据集合。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase04.png alt=image></p><h3 id=图数据库典型应用场景>图数据库典型应用场景</h3><p>举几个例子来讲，典型图数据库的应用场景有以下几个。</p><h4 id=社交场景>社交场景</h4><p>社交场景是一个我们常见的社交场景，就是好友之间的关系。这个自然而然构成了一张图。比如说：在社交场景里面，做推荐算法。为某个人推荐他的好友。现在典型的方法都是去找好友的好友，然后看好友的好友有没有可能成为新的好友。这里面可能会有各种亲密度关系，以及各种各样的排序。传统来讲，我们可能会利用 MySQL 或者是 HBase 存各种各样的好友关系，然后通过多个<strong>串行的 Key Value 访问来查</strong>。但是真正在线上场景里面的话，是很难满足性能要求的。所以，另外一种做法是利用<strong>离线计算</strong>。把可能的好友关联和推荐都离线计算好。然后，查的时候直接去读已经准备好的数据，但这个问题就在于时效性比较差。对于有一些对于时效性要求比较高的场景，这样是不可以接受的。后面我有一些 case 可以来谈这个事情。</p><h4 id=商业关系网络>商业关系网络</h4><p>商业关系网络：数据库的使用场景除了社交网络外，还有商业关系网络也很常见。在金融和风控领域，商业关系其实是很典型的一张图，多个公司之间有贸易往来，公司和银行之间也有往来。比如说一个公司去银行申请贷null款的时候，银行在审查这家公司可能本身没有什么问题，但是这家公司可能控制或者被控制的其他公司，或者整个集团的其他子公司，早已经进入了黑名单，甚至要控制一组相互担保的公司之间的总体贷款额度。这个时候就需要构成一些风控的功能来拒掉这笔贷款。商业关系里面还有人与人之间的转账关系，比如去查一个信用卡反套null现的网络。很典型的一个网络社群就是：A 转账到 B，B 转账到 C，C 又转让回 A 就是一个很典型的一个环。更多的黑产可能会是一个很大的黑产社区。对于这样的闭环，这类查询在图数据库大规模应用之前，大部分都是采用离线计算的方式去找。但是离线场景很难去控制当前发生的这笔交易。例如一个信用卡交易或者在线贷null款，整个作业流程很长，在反套null现这块的审核时间可能只有秒级。这也是图数据库非常大的一个应用场景。</p><h4 id=知识图谱>知识图谱</h4><p>知识图谱：除了商业关系还有一个就是知识图谱。知识图谱这个概念提出来已经很早了，大概是在 2004，2005 年的时候，Google 把自己的 search engine 慢慢的从倒排转到知识图谱上。这样在 search 的时候可以回答一些问题，比如说今天的天气怎么样？比如说现在谁的老婆的外甥的二大爷是谁。根据一些类似于问题式的知识，而不是基于关键字进行 search。知识图谱这几年非常的火，主要的原因就是一些垂直领域，慢慢的发现知识图谱非常的有价值。比如说：在金融领域上会有自己金融领域的知识图谱，结合一些 NLP 技术做大量的财报自动分析，或者像 Kensho 这样的新闻事件驱动自动生成分析报表和投资建议；还可以做一些投资组合，发现一二级市场公司内的关联关系，财务造假或者地方债暴雷造成的风险传播。再比如很多做在线教育的同事可能知道，在线教育的领域里面也有不少知识图谱。比如说有哪些考点，这个题是属于哪些考点，考点之间是怎么关联起来的，做错的考点附近的知识点都需要加强，这样也是一张关系网络。也是图数据库一个广泛应用的场景。</p><h4 id=iot-物联网internet-of-things>IoT 物联网（Internet of Things）</h4><p>IoT 物联网（Internet of Things）是目前非常火的。以前，每一个设备都是单纯的 Device，设备和设备之间是没有关系的。但是，物联网的出现打通了这些设备之间的关系。比如：账号和设备都是有绑定关系的，账号和账号之间又有一定的关系，通过这样设备之间也可以建立出一张网络来。</p><p><strong>一般来说，图数据库并不是简单的关联关系查询，在图遍历的过程，通常要根据属性做一些计算</strong>。所以一个单单的图关联是完全不能满足要求的。举个例子，这是一个股票新闻实时推荐的场景。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase05.png alt=image></p><p>大家知道一般散户炒股并不是高频这样事件驱动的，但是他们也会边看新闻边盯着 K线。所以在这个时候要给他们推荐一些什么新闻呢。一般常见的办法是爬虫获得新闻，清洗完毕后，NLP 分词，提取出关键词后，然后跟股票代码关联上。一般根据监管，可能还要加上一些编辑审核和推送。但大家知道中国股市好的时候，是线下口口相传的。所以有个思路是通过好友圈来推荐新闻：首先会去找用户的好友，然后这些好友可能浏览过一些文章，那么根据驻留时间等，好友对这个文章可能会有一个评分，这个评分用 WL 来表示。好友和好友之间也有一定的亲密度，用 WC 表示。这个亲密度可以来源于之前的聊天次数、转账次数等。同一个人到一篇文章之间可能会有多条路径。比如说到第二篇文章，可能会有几十条路径。所以说这么多条路径的权值之和代表了我和这篇文章的之间的评分。最终给用户推荐文章的时候，希望是把所有的计算结果做 Top N。从线上的结果来看，转化效率比其他几种都要高。</p><h2 id=图数据库面临的挑战>图数据库面临的挑战</h2><p>再回到技术底层，图数据库面临的技术挑战。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase06.png alt=image></p><h3 id=低延时高吞吐>低延时高吞吐</h3><p>一个挑战就是极低的 latency 和极高的 throughput。比如说查寻好友的好友这样的两跳场景，我们的 Nebula Graph 能在十毫秒以内返回，同时能做到单机 10 万的 pps。</p><h3 id=大数据量>大数据量</h3><p>另外一个挑战就是数据量。一个典型的银行金融图谱，数据量已经可以达到百 T 规模，大概是几十亿个点和千亿条边的规模。当然，如果图本身只是存点 ID 和点 ID 之间的关联关系，这样的数据量千亿级别其实单机也能存储。但是实际上就像刚才说的，光纯点和边是不够的，还需要有很多图属性做分析，这样单机是肯定不够的。另外就是数据量增长的速度相当快，即使今天单机做个 POC 能存下，可能几个月之后又要扩容了。</p><h3 id=复杂的商业逻辑>复杂的商业逻辑</h3><p>还有一个挑战就是现在越来越复杂的商业逻辑，用传统的数据库去分析，基本上每一个逻辑都要写 Java 代码来完成查询数据。我们希望不要那么依赖于开发人员，分析人员可以像写 SQL 一样，自己可以搞定。</p><h3 id=高可用>高可用</h3><p>最后一个挑战就是关于高可用要求。图数据库刚开始出现的时候，基本上就是一个二级索引。相当于只缓存了点和边之间的关系，真正的属性可能是在别的地方（比如 HBase 或者 MySQL 里面）。Data 本身的正确性和高可用都是都是依赖于这些组件的。但随着使用场景越来越多，这样分离的存储方式性能跟不上，自然就希望数据直接放在图数据库里面。那么各种传统数据库和分布式系统要面临的技术问题也要解决。比如数据多副本的强一致性问题，ACID。对于图数据库的要求越来越多，客户更希望作为一个数据库，而不是作为一个索引或者关系 cache。</p><h2 id=nebula-graph-的特点>Nebula Graph 的特点</h2><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase07.png alt=image></p><h3 id=存储计算分离><strong>存储计算分离</strong></h3><p>对于 Nebula Graph 来讲，有这么几个技术特点：第一个就是采用了存储计算分离的架构。这样架构主要的考虑其实前面几个 Talk大家都已经讨论了很多，主要好处就是为了上云或者说 <code>弹性</code>  ， <code>方便单独扩容</code>  。上午的 Talk：HBase on Cloud 也有提到，业务水位总是很难预测的，一段时间存储不够了，有些时候计算不够了。在云上或者使用容器技术，计算存储分离的架构运维起来会比较方便，成本也更好控制。大家使用 HBase 那么久，这方面的感触肯定很多。</p><h3 id=查询语言-ngql>查询语言 nGQL</h3><p>Nebula Graph 的第二个技术特点是它的查询语言，我们称为 nGQL，比较接近 SQL。唯一大一点的语法差异就是 <code>不用嵌套</code> （embedding）。大家都知道嵌套的 SQL，读起来是非常痛苦的，要从里向外读。</p><h3 id=支持多种后端存储>支持多种后端存储</h3><p>第三个特点就是 Nebula Graph 支持多种后端存储，除了原生的引擎外，也支持 HBase。因为很多用户，对 HBase 已经相当熟悉了，并不希望多一套存储架构。从架构上来说，Nebula Graph 是完全对等的分布式系统。</p><h3 id=计算下推><strong>计算下推</strong></h3><p>和 HBase 的 CoProcessor 一样，Nebula Graph 支持数据计算下推。数据过滤，包括一些简单的聚合运算，能够在存储层就做掉，这样对于性能来讲能提升会非常大。</p><h3 id=多租户>多租户</h3><p>多租户，Nebula Graph是通过多 Space 来实现的。Space 是物理隔离。</p><h3 id=索引>索引</h3><p>除了图查询外，还有很常见的一种场景是全局的属性查询。这个和 MySQL 一样，要提升性能的主要办法是为 <code>属性建立索引</code> ，这个也是 Nebula Graph 原生支持的功能。</p><h3 id=图算法><strong>图算法</strong></h3><p>最后的技术特点就是关于图算法方面。这里的算法和全图计算不太一样，更多是一个子图的计算，比如最短路径。大家知道数据库通常有 OLTP 和 OLAP 两种差异很大的场景，当然现在有很多 HTAP 方面的努力。那对于图数据库来说也是类似，我们在设计 Nebula Graph 的时候，做了一些权衡。我们认为全图的计算，比如 Page Rank，LPA，它的技术挑战和 OLTP 的挑战和对应的设计相差很大。我们希望 Nebula Graph 能够在 OLTP 这块提供最好的表现。</p><h2 id=nebula-graph-的架构图>Nebula Graph 的架构图</h2><p>下面为大家介绍 Nebula Graph 的架构图：下图（图1）是基于原生存储的，图3 是基于 HBase 的，有一些不同。</p><h3 id=基于原生存储的架构图>基于原生存储的架构图</h3><p>这条虚线上面是计算层，下面是存储层。
<img src=https://nebula-blog.azureedge.net/nebula-blog/HBase08.png alt=基于原生存储的架构图></p><p>图 1：基于原生存储的架构图</p><p>我们先看下计算层，计算层可以理解为把一个 query 翻译成真正需要的执行计划，产生执行计划之后，到下面存储层拿需要的数据。这和传统数据库非常类似，查询语言也很类似。这里面比较重要的事情是查询优化，除了前面提到的计算下推到存储层外，目前一个主要的实现是并发执行。</p><h3 id=查询服务架构图>查询服务架构图</h3><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase09.png alt="Query Service"></p><p>图 2：Query Service</p><p>举个例子，查好友的大于 18 岁的好友，可能好友有很多，没有必要等一度好友都返回后，再去查二度好友。当然应该异步来做，一度好友部分返回后，就立刻开始二度查询。有点类似图计算里面的 BSP 和 ASP。这个优化对提升性能有非常大作用。对于 Storage 层来说，又分为上面的 Storage Engine 和 KV Store。因为 Nebula Graph 是分布式系统，数据是分片的。目前的分片方法是静态哈希，和 HBase 不一样。主要是因为图查询基本都是特定 Prefix 的 Scan，Get 很少。比如一个人的好友这样，就是同一个 prefix 的 scan。每一个数据分片会通过 RAFT 协议来保证数据的强一致。这和 HBase 写到底层 HDFS 也不一样。3 台机器上的 Partition1 组成一个 Raft Group。Storage Engine 做的事情比较简单，就是把图语义的查询请求翻译成 KV 的查询请求。关于图右边的 Meta Service，它的主要作用是 schema 管理和集群管理。Nebula Graph 中的点和边都是有属性和版本的，那每个属性的类型和版本在 MetaService 中统一管理。集群管理主要用于运维和鉴权目的，负责机器上下线和对用户做 ACL。</p><h3 id=nebula-graph-基于-hbase-的架构图>Nebula Graph 基于 HBase 的架构图</h3><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase10.png alt=HBase></p><p>图 3：基于 HBase 的架构图</p><p>Nebula Graph 的 HBase 版本略微有些不一样，可以看到虚线往下挪了，Storage Service 嵌入到 Query Engine 里面，这是因为 HBase 是独立的服务，Storage Service 进程可以和 Query Engine 放同一台机器上，直接一对一服务了。另外，因为 HBase 自己有 partition，就没必要再分一次了。</p><h2 id=nebula-graph-的数据模型和-schema>Nebula Graph 的数据模型和 Schema</h2><p>下面介绍下 Nebula Graph 的数据模型和 Schema（每种标签有一组相对应的属性，我们称之为 schema）。前面说到 Nebula Graph 是有向属性图，点和边都有各自属性。点有点属性，Nebula Graph 里面称为 Tag（类型），点可以有多种类型，或者叫多种 Tag。比如一个点既可以是 Tag  Person，有属性姓名、年龄；也是 Tag developer，属性是擅长的语言。Tag 是可以像类一样继承的，一个 Tag 继承自另外一个 Tag。边和点略微有点不一样，一条边只能有一种类型。但是两个点之间可以有多种类型的边。另外，像 TTL 这种功能，Nebula Graph 也是支持的。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase11.png alt=image></p><p><strong>Nebula Graph 的数据模型和 Schema</strong></p><blockquote><p>这里需要提一下，对于 HBase 和 Nebula Graph 原生存储来说，Schema Version 处理上是不一样的。HBase 是没有 Schema 的</p></blockquote><p>强 Schema 最大的好处，是知道这条数据什么时候结束的，一行有多少属性是知道的。所以在根据某个版本号取数据的时候，从某一行跳到下一行，不需要对每个属性都扫描一遍。但如果像 HBase 这样弱 Schema 系统，性能消耗是非常大。但相应的，问题就来了，如果要支持强 Schema，要变更 Schema 怎么办？更改 Schema 在 MySQL 里面，往往要锁表的。对于 Nebula Graph 来说，当更改 Schema 时，并不是在原来的数据上进行更改，而是先插入一个新的 Schema，当然这要求写入数据的时候就要记录版本号。这样的话在读的时候，才能知道要用版本。</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase12.png alt=image></p><p>再解释一下关于 Key 的设计，点和边的 Key 设计是像上面两行这样，一个点是一个 Key，一条边是两个 Key，这样的目的是把起点和出边存在一起，对端的终点和入边存储在一起。这样在查询的时候，可以减少一次网络。另外，对于 Nebula Graph 原生存储和 HBase 存储，属性采用的存储方式也是不一样的。在 HBase 里面，一个属性放在一个 Column 里面。在原生存储里面，所有属性放在一个 Column 里面。这样设计的主要原因是，如果用户使用 HBase 作为底层存储，其实他更期望 HBase 这张表在别的系统里面也可以用，所以说我们考虑把它打散开了。</p><h2 id=nebula-graph-查询语言ngql>Nebula Graph 查询语言 nGQL</h2><p>最后讲一下我们的 Query Language：nGQL</p><p><img src=https://nebula-blog.azureedge.net/nebula-blog/HBase13.png alt=image></p><p>我们说它比较类似 SQL，比如说看这个例子，从某一个点开始向外拓展，用 nGQL 来写就是，GO FROM $id，起始点，然后 OVER edge，沿着某条边，还可以设置一些过滤条件，比如说，从这个点出发，沿着我的好友边，然后去拿，里面年龄大于十八岁的。</p><p>那要返回哪些属性？可以用 YIELD，比如说年龄，家庭住址。前面提到，不希望嵌套，嵌套太难读了，所以作为替代， Nebula Graph 用 PIPE 管道。前一条子查询的结果，PIPE 给第二条，然后第二条可以 PIPE 给第三条。这样从前往后读起来，和我们人的思考顺序是一样的。但是管道只解决了一个输入源的问题。</p><p>多个输入源的时候怎么办？Nebula Graph 还支持定义某个变量，这个和存储过程有点像。像上面这样，把 $var 定义成一个子查询的结果，再把这个结果拿去给其他子查询使用。还有种很常见的查询是全局匹配，这个和 SQL 里面的 SELECT … FROM … WHERE 一样，它要找到所有满足条件的点或者边。我们这里暂时取名叫做 FIND。大家要是觉得其他名字好也可以在 GitHub 上给我们提 issue。</p><p>最后就是一些 UDF，用户自己写的函数，有些复杂的逻辑用 SQL 可能不好描述，Nebula Graph 也希望支持让用户自己写一些代码。因为我们代码是 C++ 写的，再考虑到用户群体，做数据分析用 Python 比较多，我们考虑先支持 C++ 和 Python。</p><h2 id=qa>Q&A</h2><p>现场参会者提问：你们这个架构是 TinkerPop 的实现嘛？区别在哪里？</p><p>陈恒的回复如下：</p><blockquote><p>不是的。我们是完全自研的。</p></blockquote><blockquote><p>首先我们查询语法并不是 Gremlin 那样命令式的，而是更接近 SQL 这种描述式的。可以说下我们的思考，我们主要考虑了查询优化的问题。</p></blockquote><blockquote><p>你知道像 Gremlin 那样的命令式语言，query 是 .in() .out() 这样一步步组成的，所以查询引擎只能按照给定的命令一步步把数据捞上来，每次序列化速度都很慢的，像 Titan 那样。我们的测试结果应该有几十倍的性能差距。</p></blockquote><blockquote><p>另外既然用户每步指令是明确的，查询引擎要做优化很难，要非常智能推测出用户整一串指令的最终期望才能优化，这样难度比较高。这个有点像编译器的优化，优化错就很麻烦了。</p></blockquote><blockquote><p>我们希望像 SQL 这样描述式的，用户说明最终目的就行，怎么处理交给执行引擎来优化，这样做优化比较容易完善，可借鉴的算法也比较多。</p></blockquote><blockquote></blockquote><blockquote><p>当然也和我们以 C++ 做开发语言有关。我们也有想过做 Gremlin 和 nGQL 之间的 driver，主要看社区，欢迎给我们提 issue</p></blockquote><p>上面就是本次 Nebula Graph 参会 HBaseCon Asia2019 的全部内容，最后和大家再说下 Nebula Graph 是完全开源的项目，对于图数据库比较感兴趣的同学可以加 wechat 讨论群，或者在<a href=https://github.com/vesoft-inc/nebula> GitHub </a>上提 Issue，也欢迎大家给我们支持 star 项目。</p><h2 id=推荐阅读>推荐阅读</h2><ul><li><a href=https://nebula-graph.io/cn/posts/nebula-graph-data-model-and-system-design/>图数据库 Nebula Graph 的数据模型和系统架构设计</a></li><li><a href=https://nebula-graph.io/cn/posts/nebula-graph-design-in-practice/>Vol.03 nMeetup | 图数据库综述与 Nebula 在图数据库设计的实践</a></li></ul><blockquote class=star-ads><span>你喜欢这篇文章吗? 喜欢的话，给我们点个</span>
<span class="glyphicon glyphicon-star"></span><span>star 吧:</span>
<a href=https://github.com/vesoft-inc/nebula>https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/nebula-website/cn/tags/%e6%8a%80%e6%9c%af%e6%bc%94%e8%ae%b2>技术演讲</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>分享</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=wechat><img alt="wechat-white sharing button" src=https://platform-cdn.sharethis.com/img/wechat-white.svg>
<span class=st-label>微信</span></li><li class=st-custom-button data-network=weibo><img alt="weibo-white sharing button" src=https://platform-cdn.sharethis.com/img/weibo-white.svg>
<span class=st-label>微博</span></li><li class=st-custom-button data-network=sharethis><img alt="sharethis-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>其他</span></li></ul></li><li onclick="location.href='\/nebula-website\/cn\/posts'"><img src=/images/blog.png>
<a href=/nebula-website/cn/posts>返回到博客页</a></li><li onclick="location.href='https:\/\/nebula-graph.io/cn/posts/index.xml'"><img src=/images/rss.png>
<a onclick="window.open('https:\/\/nebula-graph.io/cn/posts/index.xml')" href>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3 class="glyphicon glyphicon-tag">标签</h3><ul class=blog-tags><li class=col-md-12><a href=/nebula-website/cn/posts class=active>全部</a></li><li><a href=/nebula-website/cn/tags/release-note>release-note</a></li><li><a href=/nebula-website/cn/tags/%E4%BA%A7%E5%93%81%E5%8A%A8%E6%80%81>产品动态</a></li><li><a href=/nebula-website/cn/tags/%E4%BA%A7%E5%93%81%E8%AE%B2%E8%A7%A3>产品讲解</a></li><li><a href=/nebula-website/cn/tags/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86>图数据库知识</a></li><li><a href=/nebula-website/cn/tags/%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5>应用实践</a></li><li><a href=/nebula-website/cn/tags/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97>开发日志</a></li><li><a href=/nebula-website/cn/tags/%E6%80%A7%E8%83%BD>性能</a></li><li><a href=/nebula-website/cn/tags/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2>技术演讲</a></li><li><a href=/nebula-website/cn/tags/%E6%9E%B6%E6%9E%84%E5%89%96%E6%9E%90>架构剖析</a></li><li><a href=/nebula-website/cn/tags/%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80>查询语言</a></li><li><a href=/nebula-website/cn/tags/%E7%89%B9%E6%80%A7%E8%AE%B2%E8%A7%A3>特性讲解</a></li><li><a href=/nebula-website/cn/tags/%E7%A4%BE%E5%8C%BA>社区</a></li><li><a href=/nebula-website/cn/tags/%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95>系统测试</a></li><li><a href=/nebula-website/cn/tags/%E7%BC%96%E8%AF%91>编译</a></li><li><a href=/nebula-website/cn/tags/%E9%83%A8%E7%BD%B2>部署</a></li></ul></div><div id=blog-carousel class="carousel slide" data-ride=carousel><ol class=carousel-indicators><li data-target=#blog-carousel data-slide-to=0 class=active></li><li data-target=#blog-carousel data-slide-to=1></li></ol><div class=carousel-inner role=listbox><div class="item active" onclick="location.href='\/cn\/posts\/clean-stale-data-with-ttl-in-nebula-graph\/'"><img src=https://nebula-blog.azureedge.net/nebula-blog/TTL01.png alt="TTL 特性讲解" width=220px height=150px><div class=carousel-caption>TTL 特性讲解</div></div><div class=item onclick="location.href='\/cn\/posts\/github-action-automating-project-process\/'"><img src=https://nebula-blog.azureedge.net/nebula-blog/Action01.png alt="Action 自动化发布" width=220px height=150px><div class=carousel-caption>Action 自动化发布</div></div></div><a class="left carousel-control" href=#blog-carousel role=button data-slide=prev><span class="glyphicon glyphicon-chevron-left" aria-hidden=true></span><span class=sr-only>Previous</span></a>
<a class="right carousel-control" href=#blog-carousel role=button data-slide=next><span class="glyphicon glyphicon-chevron-right" aria-hidden=true></span><span class=sr-only>Next</span></a></div><div class=blog-anchors><h3>目录</h3><nav id=TableOfContents><ul><li><a href=#本篇导读>本篇导读</a></li><li><a href=#nebula-graph-简要介绍>Nebula Graph 简要介绍</a></li><li><a href=#nosql-类数据库的发展趋势>NoSQL 类数据库的发展趋势</a></li><li><a href=#图数据库的简要介绍>图数据库的简要介绍</a><ul><li><a href=#图数据库典型应用场景>图数据库典型应用场景</a></li></ul></li><li><a href=#图数据库面临的挑战>图数据库面临的挑战</a><ul><li><a href=#低延时高吞吐>低延时高吞吐</a></li><li><a href=#大数据量>大数据量</a></li><li><a href=#复杂的商业逻辑>复杂的商业逻辑</a></li><li><a href=#高可用>高可用</a></li></ul></li><li><a href=#nebula-graph-的特点>Nebula Graph 的特点</a><ul><li><a href=#存储计算分离><strong>存储计算分离</strong></a></li><li><a href=#查询语言-ngql>查询语言 nGQL</a></li><li><a href=#支持多种后端存储>支持多种后端存储</a></li><li><a href=#计算下推><strong>计算下推</strong></a></li><li><a href=#多租户>多租户</a></li><li><a href=#索引>索引</a></li><li><a href=#图算法><strong>图算法</strong></a></li></ul></li><li><a href=#nebula-graph-的架构图>Nebula Graph 的架构图</a><ul><li><a href=#基于原生存储的架构图>基于原生存储的架构图</a></li><li><a href=#查询服务架构图>查询服务架构图</a></li><li><a href=#nebula-graph-基于-hbase-的架构图>Nebula Graph 基于 HBase 的架构图</a></li></ul></li><li><a href=#nebula-graph-的数据模型和-schema>Nebula Graph 的数据模型和 Schema</a></li><li><a href=#nebula-graph-查询语言ngql>Nebula Graph 查询语言 nGQL</a></li><li><a href=#qa>Q&A</a></li><li><a href=#推荐阅读>推荐阅读</a></li></ul></nav></div><div class=social-share><h3>分享</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=wechat><img alt="wechat-white sharing button" src=https://platform-cdn.sharethis.com/img/wechat-white.svg></div><div class="st-custom-button st-remove-label" data-network=weibo><img alt="weibo-white sharing button" src=https://platform-cdn.sharethis.com/img/weibo-white.svg></div><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><p align=center class=statement>Nebula Graph will respect your data privacy per our Privacy Policy</p><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>论坛</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=微博 data-toggle=modal target=_blank data-target>微博</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/gongzhonghao.png>
<a href title=微信公众号 data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>微信公众号</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>微信个人助理</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><div id=J-star-popup class=nebula-star-popup></div><script src=/nebula-website/js/jquery.js></script><script src=/nebula-website/js/bootstrap.min.js></script><script src=/nebula-website/js/jquery.easing.min.js></script><script src=/nebula-website/js/jquery.fittext.js></script><script src=/nebula-website/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/nebula-website/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/nebula-website/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"\/nebula-website\/cn\/posts\/nebula-graph-in-hbasecon-asia-2019\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script></body></html>