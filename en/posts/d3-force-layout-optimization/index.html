<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="D3-Force Directed Graph Layout Optimization in Nebula Graph Studio"><meta property="twitter:title" content="D3-Force Directed Graph Layout Optimization in Nebula Graph Studio"><meta name=twitter:description content="Nebula Graph Studio has adopted D3-force directed graph to visualize data connections. This post has shared two ideas to optimize the force-directed graph layout."><meta name=og:description content="Nebula Graph Studio has adopted D3-force directed graph to visualize data connections. This post has shared two ideas to optimize the force-directed graph layout."><meta name=twitter:image content="/nebula-website/en/posts/d3-force-layout-optimization/D3_hu3fc789fff3d0d1c0383282d7e6791809_1639410_600x0_resize_q75_box.jpg"><meta name=og:image content="/nebula-website/en/posts/d3-force-layout-optimization/D3_hu3fc789fff3d0d1c0383282d7e6791809_1639410_600x0_resize_q75_box.jpg"><meta name=description content="Nebula Graph Studio has adopted D3-force directed graph to visualize data connections. This post has shared two ideas to optimize the force-directed graph layout."><meta name=generator content="Hugo 0.65.3"><title>D3-Force Directed Graph Layout Optimization in Nebula Graph Studio</title><link rel="shortcut icon" href=/nebula-website/favicon.ico><link rel=stylesheet href=/nebula-website/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/nebula-website/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/creative.css type=text/css><link rel=stylesheet href=/nebula-website/css/modals.css type=text/css><link rel=stylesheet href=/nebula-website/css/animate.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/nebula-website/js/jquery.js></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPJVFGH');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPJVFGH" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=nav-popup id=nav-popup><img src=/images/popup.png><img src=/images/popup.png> Nebula Graph RC4 is released! <a href=https://github.com/vesoft-inc/nebula/releases/tag/v1.0.0-rc4 target=_blank>Get Started</a> <img src=/images/shut.png id=shut onclick=shut()></div><div class=container-fluid><div class=navbar-header><div class=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/nebula-website/en/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>Docs</a></li><li class=active><a href=/en/posts target>Blog</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><a href=#contact_us target onclick=contactUsClick()>Contact Us</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank onclick="gtag('event','Button Click',{event_category:'Engagement',event_label:'Nebula Studio'})">Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}
function shut(){$('#nav-popup').remove();$("#top").css("padding-top","50px")
sessionStorage.setItem("popupIsRemove",true);}
if(!sessionStorage.getItem("popupIsRemove")){$("#nav-popup").css("display","block")}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><div class=blog-left-aside><div class=social-share id=J_Share><h3>Share</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div><section class=blog-content><h1>D3-Force Directed Graph Layout Optimization in Nebula Graph Studio</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>Nico</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2020-04-29</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/nebula-website/en//tags/features>features</a><a href=/nebula-website/en//tags/dev-log>dev-log</a></div></div><p><img src=https://user-images.githubusercontent.com/57335825/81265062-02c10900-9075-11ea-8049-bf3849df5791.png alt="D3-Force Directed Graph Layout Optimization in Nebula Graph Studio"></p><h2 id=what-is-d3js>What is D3.js</h2><p><a href=https://d3js.org/>D3.js</a> is an open-source JavaScript library for producing dynamic, interactive data visualizations in web browsers using SVG, HTML and CSS.</p><p>In addition to D3, there are other popular and powerful libraries such as <a href=https://echarts.apache.org/examples/zh/index.html>ECharts</a> and <a href=http://chartjs.cn/>Chart.js</a>. However, they are <strong>highly encapsulated</strong>,leaving too little room for customization.</p><p>In the contrary, D3 is highly customizable thanks to its support for <strong>event handling for SVG elements</strong>. It can bind arbitrary data to the document object model (DOM) or directly operate <a href=https://www.w3.org/DOM/DOMTR>W3C DOM API</a> on the DOM.</p><p>For those who want full control of their graph layout, D3 is definitely a go-to choice.</p><h2 id=d3-forcedirected-graph>D3-Force Directed Graph</h2><p>For social networks analysis, D3-force directed graph is the best choice. It is a module realized in D3 by simulating the <a href=https://en.wikipedia.org/wiki/Verlet_integration>velocity Verlet</a> numerical integrator for physical forces on particles. Each node in D3-force can be regarded as a discharge particle, and there is repulsion (Coulomb repulsion) among the particles. At the same time, these particles are connected by the edges among them, thus generating traction.</p><p>Because of the repulsion and traction, particles in D3-force continuously shift from the initial state of random disorder to a balanced and ordered layout. The <a href=https://en.wikipedia.org/wiki/Verlet_integration>velocity Verlet</a> numerical integrator controls the order of particles and edges. The graph generated with d3-force contains only nodes and edges and there is only a small collection of <a href=https://observablehq.com/collection/@d3/d3-force>graph samples</a> for reference because most graphs are customized.</p><p>The following is a popular network diagram I found that is realized with D3-force. Apparently it is too simple for some use cases. So if yours is more complex than that, then you have to create your own graph.</p><p><img src=https://user-images.githubusercontent.com/57335825/81265260-5895b100-9075-11ea-8dec-a4aeadbe33ab.png alt="force-directed graph example"></p><h2 id=building-d3-forcedirected-graph>Building D3-Force Directed Graph</h2><p>In Nebula Graph Studio, we use the D3-force directed graph to analyze data relationships because the nodes and edges show the data connections intuitively and it allows graph exploration via <a href=https://nebula-graph.io/en/posts/graph-query-language-comparison-cypher-gremlin-ngql/>graph query language</a>. Moreover, the graph data can be updated by synchronizing the operations on the DOM to the database, which deserves another article to cover.</p><p>Let&rsquo;s build a simple D3-force directed graph to illustrate how D3.js displays data connections and share some layout optimization ideas based on this example.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>this.force <span style=color:#f92672>=</span> d3
        .forceSimulation<span style=color:#f92672>()</span>
        // Assign coordinates to nodes
        .nodes<span style=color:#f92672>(</span>data.vertexes<span style=color:#f92672>)</span>
        // Connect edges
        .force<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;link&#39;</span>, linkForce<span style=color:#f92672>)</span>
        // The instance center
        .force<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;center&#39;</span>, d3.forceCenter<span style=color:#f92672>(</span>width / 2, height / 2<span style=color:#f92672>))</span>
        // Gravitation
        .force<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;charge&#39;</span>, d3.forceManyBody<span style=color:#f92672>()</span>.strength<span style=color:#f92672>(</span>-20<span style=color:#f92672>))</span>
        // Collide force to prevent nodes overlap
        .force<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;collide&#39;</span>,d3.forceCollide<span style=color:#f92672>()</span>.radius<span style=color:#f92672>(</span>60<span style=color:#f92672>)</span>.iterations<span style=color:#f92672>(</span>2<span style=color:#f92672>))</span>;
</code></pre></div><p>The code above generates a graph as below:</p><p><img src=https://user-images.githubusercontent.com/57335825/81265424-a8747800-9075-11ea-88fe-3f7a21de77d0.png alt="force-directed graph in Nebula Graph Studio"></p><h3 id=graph-exploration-layout-optimization>Graph Exploration Layout Optimization</h3><p>The graph above displays only one-hop relationships from the starting nodes. How about two- or three-hop relationships? The answer is the D3.js <a href=https://www.d3indepth.com/enterexit/#enter>enter()</a> API.</p><p>The D3.js <a href=https://www.d3indepth.com/enterexit/#enter>enter()</a> API processes the new nodes independently. When new nodes are queried and pushed into the nodes array, the API renders them according to the coordinates assigned by the D3-force instance, without changing the information (x, y coordinates included) of the existing nodes.</p><p>From the perspective of API, this is definitely understandable. But the newly added nodes can not be handled just with a simple push to the existing D3-force instance because the <a href=https://github.com/d3/d3-force/blob/master/src/simulation.js>d3.forceSimulation()</a> module assigns location coordinates randomly.</p><p>The coordinates assigned by d3.forceSimulation().node() are random, so are the locations of the explored nodes. Together with the collied and link parameter, nodes associated with the new ones are close to each other under the influence of tractive force.  Also, there are collisions among other nodes in the process of approaching. When there are nodes on the force-directed graph, these newly added nodes will make the entire graph collide under the effect of the collision and traction until each node finds its own place. That means the movement only stops when the collision and traction both meet the requirement. Does it look like the Big Bang?</p><p><img src=https://user-images.githubusercontent.com/57335825/81270806-d9f14180-907d-11ea-8aa1-cda0a3f8b1ef.gif alt="force-directed graph movement"></p><p>There are two problems in the above process:</p><ol><li>Adding a new node would result in the entire graph&rsquo;s constant moving</li><li>It takes a relatively long time to be stable</li></ol><p>However, this is how the the enter() API is designed.</p><p>One solution is to process new nodes and the existing ones separately, which means each node rendering requires traverse to determine whether it&rsquo;s new or existing. Not a performant solution, especially when the quantity is large.</p><p>Another common solution is to reduce the collision and increase traction of the D3-force instance. In this way, the nodes find balance state more quickly so that the entire graph is stable. This is a better solution but the disadvantage is that it makes the connection among nodes varies remarkably in length and the graph size is huge. So it&rsquo;s not an ideal solution for cases with huge data.</p><p>We&rsquo;ve come up with a new solution.</p><p>The idea is to ensure that the new node is around the source node. Instead of D3.forceSimulation().node() allocation, set the coordinates of the new node the same as that of the source node. The node collision of the D3-force instance ensures that the appearance of new nodes will not be overwritten, and will eventually appear around the source node.</p><p>Although such solution still affects the nodes within a small range, it will not greatly affect the trend of the entire graph. The key codes are as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># Set the new nodes coordinates as the source node center or the entire graph center</span>
addVertexes.map<span style=color:#f92672>(</span>d <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
  d.x <span style=color:#f92672>=</span> _.meanBy<span style=color:#f92672>(</span>selectVertexes, <span style=color:#e6db74>&#39;x&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span> svg.style<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;width&#39;</span><span style=color:#f92672>)</span> / 2;
  d.y <span style=color:#f92672>=</span> _.meanBy<span style=color:#f92672>(</span>selectVertexes, <span style=color:#e6db74>&#39;y&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>||</span> svg.style<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;heigth&#39;</span><span style=color:#f92672>)</span> / 2;
<span style=color:#f92672>})</span>;
</code></pre></div><p>If there&rsquo;s no source node, then the new node appears at the center of the graph. This will pose less effect on the existing nodes thus is worth considering.</p><h3 id=layout-optimization-of-multiple-edges-display-between-two-nodes>Layout Optimization of Multiple Edges Display Between Two Nodes</h3><p>When there are multiple edges between two nodes, the following problems occur:</p><ol><li>The default straight line will overwrite each other. Therefore, curve is a better choice under such circumstances.</li><li>How to define the curvature of the curve to ensure there are no overwritten?</li><li>When you have multiple curves, how to make sure the average semi-circular arc is not on a certain semi-circular?</li></ol><p>Below is how we solve the above problems:</p><ol><li>First count the edges between any two nodes and group them to a map. The key in the map is based on the name of the two nodes involved.</li><li>Then divide the edges in the same map into two groups by their direction. There are plenty of ways to determine the edge direction and here we adopt the method to compare the ASCII of source.name and target.name of a node. A linknum is set for each edge with a positive direction. Similarly, a -linknum is set for each edge with a negative direction. The linknum value we set is to determine the curvature and bending direction of the arc.</li></ol><p>Refer to the following code for better understanding:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>linkGroup</span> <span style=color:#f92672>=</span> {};
  <span style=color:#75715e>// Set the edges between two nodes as the same key based on their name property. 
</span><span style=color:#75715e></span>  <span style=color:#75715e>// Then add the key to the linkGroup, making all edges a group
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>edges</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>link</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span>) =&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span>
      <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>name</span>
        <span style=color:#f92672>?</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>name</span>
        <span style=color:#f92672>:</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>name</span>;
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>linkGroup</span>.<span style=color:#a6e22e>hasOwnProperty</span>(<span style=color:#a6e22e>key</span>)) {
      <span style=color:#a6e22e>linkGroup</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> [];
    }
    <span style=color:#a6e22e>linkGroup</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>link</span>);
  });
  <span style=color:#75715e>// Traverse each group to call setLinkNumbers to allocate linknum
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>edges</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>link</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span>) =&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setLinkName</span>(<span style=color:#a6e22e>link</span>);
    <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>linkGroup</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>length</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>group</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>linkGroup</span>[<span style=color:#a6e22e>key</span>];
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>group</span>[<span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>===</span> <span style=color:#a6e22e>link</span>) {
      <span style=color:#a6e22e>setLinkNumbers</span>(<span style=color:#a6e22e>group</span>);
    }
  });
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#75715e>// Divide the edges into linkA and linkB based on their directions.
</span><span style=color:#75715e>// Then allocate two kinds of linknum to control the upper and lower elliptical arc.
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setLinkNumbers</span>(<span style=color:#a6e22e>group</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>len</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>group</span>.<span style=color:#a6e22e>length</span>;
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>linksA</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> [];
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>linksB</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span> <span style=color:#f92672>=</span> [];
  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>len</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>link</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>group</span>[<span style=color:#a6e22e>i</span>];
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>link</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>name</span>) {
      <span style=color:#a6e22e>linksA</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>link</span>);
    } <span style=color:#66d9ef>else</span> {
      <span style=color:#a6e22e>linksB</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>link</span>);
    }
  }
  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startLinkANumber</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
  <span style=color:#a6e22e>linksA</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>linkA</span>=&gt; {
    <span style=color:#a6e22e>linkA</span>.<span style=color:#a6e22e>linknum</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>startLinkANumber</span><span style=color:#f92672>++</span>;
  }
  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startLinkBNumber</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
  <span style=color:#a6e22e>linksB</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>linkB</span>=&gt; {
    <span style=color:#a6e22e>linkB</span>.<span style=color:#a6e22e>linknum</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>startLinkBNumber</span><span style=color:#f92672>--</span>;
  }
}
</code></pre></div><p>After allocating linknum to each edge, the sign of linknum is judged in the tick event function that monitors the edges. We only need to judge and set <a href=https://www.w3schools.com/graphics/svg_path.asp>the curvature and direction of the path</a>.</p><p>Here&rsquo;s how it looks:</p><p><img src=https://user-images.githubusercontent.com/57335825/81265818-48320600-9076-11ea-9cad-18f91433beb9.png alt="Optimize multiple edges between two nodes"></p><h2 id=conclusion>Conclusion</h2><p>This is how we optimized the D3.js force-directed graph. There are many issues to concern and optimize if you&rsquo;re building a complex relationships.</p><p>In this article we shared the two most common scenarios, i.e. presenting new nodes and multiple edges between two nodes. We will share more experiences in the future. Stay tuned!</p><p>Try Nebula Graph with <a href=https://github.com/vesoft-inc/nebula-web-docker>Nebula Graph Studio</a> to experience the D3.js visualization. Leave us a comment below or head over to our <a href=https://discuss.nebula-graph.io/>forum</a> if there are any questions.</p><blockquote><p>Hi, I&rsquo;m Nico, the front-end engineer at Nebula Graph. I&rsquo;m interested in data visualization and would like to share my experiences in this regard. Hope my post is of help to you. Please let me know if you have any ideas about this. Thanks!</p></blockquote><h2 id=you-might-also-like>You might also like</h2><ul><li><a href=https://nebula-graph.io/en/posts/github-action-automating-project-process/>Automating Your Project Processes with Github Actions</a></li><li><a href=https://nebula-graph.io/en/posts/how-to-reduce-docker-image-size/>How to Reduce Docker Image Size</a></li></ul><blockquote class=star-ads><span>Like what we do ? Star us on GitHub.</span>
<a href=https://github.com/vesoft-inc/nebula onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via blogbody'});">https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/nebula-website/en/tags/features>features</a>
<a href=/nebula-website/en/tags/dev-log>dev-log</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>Share</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg>
<span class=st-label>Twitter</span></li><li class=st-custom-button data-network=linkedin><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg>
<span class=st-label>Linkedin</span></li><li class=st-custom-button data-network=facebook><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg>
<span class=st-label>Facebook</span></li><li class=st-custom-button data-network=sharethis><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>Others</span></li></ul></li><li onclick="location.href='\/nebula-website\/en\/posts'"><img src=/images/blog.png>
<a href=/nebula-website/en/posts>Back to blog home</a></li><li onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'RSS via blogbody'});window.open('https:\/\/nebula-graph.io/en/posts/index.xml');"><img src=/images/rss.png>
<a href=javascript:void(0);>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3><img src=/img/LabelTagIcon.png>Tags</h3><ul class=blog-tags><li class=col-md-12><a href=/nebula-website/en/posts class=active>all</a></li><li><a href=/nebula-website/en/tags/architecture>architecture</a></li><li><a href=/nebula-website/en/tags/community>community</a></li><li><a href=/nebula-website/en/tags/deployment>deployment</a></li><li><a href=/nebula-website/en/tags/dev-log class=active>dev-log</a></li><li><a href=/nebula-website/en/tags/features class=active>features</a></li><li><a href=/nebula-website/en/tags/graph-database>graph-database</a></li><li><a href=/nebula-website/en/tags/performance>performance</a></li><li><a href=/nebula-website/en/tags/query-language>query-language</a></li><li><a href=/nebula-website/en/tags/release-notes>release-notes</a></li><li><a href=/nebula-website/en/tags/system-testing>system-testing</a></li><li><a href=/nebula-website/en/tags/tools>tools</a></li><li><a href=/nebula-website/en/tags/use-cases>use-cases</a></li></ul></div><div class=blog-anchors id=J_Anchor><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#what-is-d3js>What is D3.js</a></li><li><a href=#d3-forcedirected-graph>D3-Force Directed Graph</a></li><li><a href=#building-d3-forcedirected-graph>Building D3-Force Directed Graph</a><ul><li><a href=#graph-exploration-layout-optimization>Graph Exploration Layout Optimization</a></li><li><a href=#layout-optimization-of-multiple-edges-display-between-two-nodes>Layout Optimization of Multiple Edges Display Between Two Nodes</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#you-might-also-like>You might also like</a></li></ul></nav></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=WeiBo data-toggle=modal target=_blank data-target>WeiBo</a></li><li><img src=/img/gongzhonghao.png>
<a href title="Official Accounts" data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>Official Accounts</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>WeChat</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><script src=/nebula-website/js/jquery.js></script><script src=/nebula-website/js/bootstrap.min.js></script><script src=/nebula-website/js/jquery.easing.min.js></script><script src=/nebula-website/js/jquery.fittext.js></script><script src=/nebula-website/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/nebula-website/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/nebula-website/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"\/nebula-website\/en\/posts\/d3-force-layout-optimization\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script><script src=/nebula-website/js/anchor.js></script></body></html><script>if(!sessionStorage.getItem("popupIsRemove")){$("#top").css("padding-top","98px")}</script>