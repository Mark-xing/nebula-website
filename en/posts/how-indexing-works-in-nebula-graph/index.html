<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="How Indexing Works in Nebula Graph"><meta property="twitter:title" content="How Indexing Works in Nebula Graph"><meta name=twitter:description content="Indexing is an indispensible function of graph databases because it can boost query performance. This article explains in detail how indexing works in Nebula Graph."><meta name=og:description content="Indexing is an indispensible function of graph databases because it can boost query performance. This article explains in detail how indexing works in Nebula Graph."><meta name=twitter:image content="/nebula-website/en/posts/how-indexing-works-in-nebula-graph/Medium_hu77da18329ab588ac33432bb3b21c4f58_427124_600x0_resize_box_2.png"><meta name=og:image content="/nebula-website/en/posts/how-indexing-works-in-nebula-graph/Medium_hu77da18329ab588ac33432bb3b21c4f58_427124_600x0_resize_box_2.png"><meta name=description content="Indexing is an indispensible function of graph databases because it can boost query performance. This article explains in detail how indexing works in Nebula Graph."><meta name=generator content="Hugo 0.65.3"><title>How Indexing Works in Nebula Graph</title><link rel="shortcut icon" href=/nebula-website/favicon.ico><link rel=stylesheet href=/nebula-website/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/nebula-website/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/creative.css type=text/css><link rel=stylesheet href=/nebula-website/css/modals.css type=text/css><link rel=stylesheet href=/nebula-website/css/animate.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/nebula-website/js/jquery.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=nav-popup id=nav-popup><img src=/images/popup.png><img src=/images/popup.png> Nebula Graph RC4 is released! <a href=https://github.com/vesoft-inc/nebula/releases/tag/v1.0.0-rc4 target=_blank>Get Started</a> <img src=/images/shut.png id=shut onclick=shut()></div><div class=container-fluid><div class=navbar-header><div class=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/nebula-website/en/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>Docs</a></li><li class=active><a href=/en/posts target>Blog</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><a href=#contact_us target onclick=contactUsClick()>Contact Us</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank>Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}
function shut(){$('#nav-popup').remove();$("#top").css("padding-top","50px")
sessionStorage.setItem("popupIsRemove",true);}
if(!sessionStorage.getItem("popupIsRemove")){$("#nav-popup").css("display","block")}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><section class=blog-content><h1>How Indexing Works in Nebula Graph</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>sky</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2020-03-12</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/nebula-website/en//tags/features>features</a></div></div><p><img src=https://user-images.githubusercontent.com/38887077/76482821-4ec64780-6450-11ea-862e-da506f5cdae2.png alt=image></p><h2 id=why-indexing-is-needed-in-a-graph-database>Why indexing is needed in a graph database</h2><p>Indexing is an indispensable function in a database system. Graph database is no exception.</p><p>An index is actually a sorted data structure in the database management system. Different database systems adopt different sorting structures.</p><p>Popular index types include:</p><ul><li>B-Tree index</li><li>B+-Tree index</li><li>B*-Tree index</li><li>Hash index</li><li>Bitmap index</li><li>Inverted index</li></ul><p>Each of them uses their own <a href=https://en.wikipedia.org/wiki/Sorting_algorithm>sorting algorithms</a>.</p><p>A database index allows efficient data retrieval from databases. Despite of the query performance improvement, there are some disadvantages of indexes:</p><ul><li>It takes time to create and maintain indexes, which scales with dataset size.</li><li>Indexes need extra physical storage space.</li><li>It takes more time to insert, delete, and update data because the index also needs to be maintained synchronously.</li></ul><p>Taking the above into consideration, <strong>Nebula Graph</strong> now supports indexing for more efficient retrieves on properties.</p><p>This post gives a detailed introduction to the design of <strong>Nebula Graph</strong> indexing.</p><p>If you prefer to the implementation part, feel free to skip the chapters in between and go directly to <a href=#nebula-graph-indexing-in-practice>Nebula Graph indexing in practice</a> section.</p><h2 id=core-concepts-to-understand-nebula-graph-indexing>Core concepts to understand Nebula Graph indexing</h2><p>Below is a list of common <strong>Nebula Graph</strong> index terms we use across the post.</p><ul><li><strong>Tag</strong>: A label associated with a list of properties. Each vertex can associate with multiple <strong>tags</strong>. Tag is identified with a TagID. You can regard tag as a node table in SQL.</li><li><strong>Edge</strong>: Similar to tag, edge type is a cluster of properties on edges. You can regard edge type as an edge table in SQL.</li><li><strong>Property</strong>: The name-value pairs on tag or edge. Its data type is determined by the tag or edge type.</li><li><strong>Partition</strong>: The minimum logical storage unit of <strong>Nebula Graph</strong>. A StorageEngine can contain multiple partitions. Partition is divided into leader and follower. We use <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwjI9IOixZPoAhWFF6YKHf-FCXAQFjAAegQIAxAB&url=https%3A%2F%2Fraft.github.io%2F&usg=AOvVaw0gbPkPuRwWu0Kd74PJmOzK">Raft</a> to guarantee data consistency between leader and follower.</li><li><strong>Graph space</strong>: A physically isolated space for a specific graph. Tags and edge types in one graph are independent with those in another graph. A <strong>Nebula Graph</strong> cluster can have multiple graph spaces.</li><li><strong>Index</strong>: Index in this post refers specifically to the index of ~~ ~~tag or edge type properties. Its data type depends on tag or edge type.</li><li><strong>TagIndex</strong>: An index created for a tag. You can create multiple indexes for the same tag. Cross-tag composite index is yet to be supported.</li><li><strong>EdgeIndex</strong>: An index created for an edge type. Similarly, you can create multiple indexes for the same edge type. Cross-edge-type composite index is yet to be supported.</li><li><strong>Scan Policy</strong>: The policy to scan indexes. Usually, there are multiple methods to scan indexes to execute one query statement, but the scan policy itself gets to decide which method to use ultimately.</li><li><strong>Optimizer</strong>: Optimize query conditions, such as sorting, splitting, and merging sub-expression nodes of the expression tree of the <em>where</em> clause. It&rsquo;s used to obtain higher query efficiency.</li></ul><h2 id=whats-required-for-indexing-in-a-graph-database>What&rsquo;s required for indexing in a graph database</h2><p>There are two typical ways to query data in Nebula Graph, or more generally in a graph database:</p><ol><li>One is starting from a vertex, retrieving its (N-hop) neighbors along certain edge types.</li><li>Another is retrieving vertices or edges which contain specified property values.</li></ol><p>In the latter scenario, a high-performance scan is needed to fetch the edges or vertices as well as the property values.</p><p>In order to improve the query efficiency of property values, we&rsquo;ve implemented indexing to Nebula Graph. By sorting the property values of edges or vertices, users can quickly locate a certain property and avoid full scan.</p><p>Here&rsquo;s what we found required for indexing in a graph database:</p><ul><li>Supporting indexing for properties on tags and edge types.</li><li>Supporting analysis and generation of index scanning strategy.</li><li>Supporting index management such as create index, rebuild index, show index, etc.</li></ul><h2 id=how-indexes-are-stored-in-nebula-graph>How indexes are stored in Nebula Graph</h2><p>Below is a diagram of how indexes are stored in Nebula Graph. Indexes are a part of Nebula Graph&rsquo;s Storage Service so we place them in the big picture of its <a href=https://nebula-graph.io/en/posts/nebula-graph-storage-engine-overview/>storage architecture</a>.</p><p><img src=https://user-images.githubusercontent.com/38887077/76482853-6c93ac80-6450-11ea-8f9d-824adfa30c72.png alt=image></p><p>Seen from the above figure, each Storage Server can contain multiple Storage Engines, each Storage Engine can contain multiple Partitions.</p><p>Different Partitions are synchronized via Raft protocol. Each Partition contains both data and indexes. <strong>The data and indexes of the same vertex or edge will be stored in the same Partition.</strong></p><h2 id=indexing-logic-breakdown>Indexing logic breakdown</h2><h3 id=storage-structure-data-vs-indexes>Storage Structure: Data vs Indexes</h3><p>In Nebula Graph, indexes and the (raw) data of vertices and edges are stored together. To better describe the storage structure of indexes, we are going to compare the structure of indexes with that of the raw data.</p><h4 id=storage-structure-of-vertices>Storage Structure of Vertices</h4><h5 id=data-structure-of-vertices>Data Structure of Vertices</h5><p><img src=https://user-images.githubusercontent.com/38887077/76483833-08261c80-6453-11ea-964b-da781448c3b5.png alt=image></p><h5 id=index-structure-of-vertices>Index Structure of Vertices</h5><p><img src=https://user-images.githubusercontent.com/38887077/76483856-15dba200-6453-11ea-9377-dc765ec46959.png alt=image></p><p>The index structure of vertex is shown in the table above, below is detailed explanations of the fields:</p><p><strong>PartitionId</strong>: We put the data and index of the vertex in the same partition because: </p><ol><li>When scanning the index, the vertex data in the same partition can be quickly obtained via the index key, so that any property values of this vertex can be easily obtained, even if the property does not belong to the index.</li><li>Currently edges are stored by hashing the ID of its starting vertex, meaning that the location of each outgoing edge is determined by its starting vertex Id. If a vertex and its outgoing edge are stored in the same partition, the index scan can quickly locate all outgoing edges of that vertex.</li></ol><p><strong>IndexId</strong>: The identifier of an index. You can get the meta data of a specified index through indexId, for example, the TagId associated with the index, and the information of the column where index is located.</p><p><strong>Index binary</strong>: The core storage structure of an index. It is the byte encoding of the values of all index related columns. Detailed structure will be explained in the <a href=#index-binary>Index Binary</a> section.</p><p><strong>VertexId</strong>: The identifier of a vertex. In real use, a vertex may have multiple lines of data due to different versions. However, there is no version for index. <strong>Index always maps to the tag of the latest Version</strong>.</p><p>Let&rsquo;s explain the storage structure with an example.</p><p>Assume that:</p><ul><li>PartitionId is 100</li><li>TagId are tag_1 and tag_2</li><li>tag_1 contains three properties: col_t1_1, col_t1_2 and col_t1_3_</li><li>tag_2 contains two properties: col_t2_1 and col_t2_2.</li></ul><p>Now let&rsquo;s create an index:</p><ul><li>i1 = tag_1 (col_t1_1, col_t1_2), here we assume the ID of i1 is 1.</li><li>i2 = tag_2(col_t2_1, col_t2_2), here we assume the ID of i2 is 2.</li></ul><p>We can see that although column col_t1_3 is included in tag_1, it is not used when creating index. <strong>This is because you can create tag index based on one or more columns in Nebula Graph</strong>.</p><h5 id=inserting-vertices>Inserting vertices</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// VertexId = hash(&#34;v_t1_1&#34;), assume id is 50
</span><span style=color:#75715e></span>
INSERT VERTEX <span style=color:#a6e22e>tag_1</span>(col_t1_1, col_t1_2, col_t1_3), tag_2(col_t2_1, col_t2_2) \
   VALUES hash(<span style=color:#e6db74>&#34;v_t1_1&#34;</span>)<span style=color:#f92672>:</span>(<span style=color:#e6db74>&#34;v_t1_1&#34;</span>, <span style=color:#e6db74>&#34;v_t1_2&#34;</span>, <span style=color:#e6db74>&#34;v_t1_3&#34;</span>, <span style=color:#e6db74>&#34;v_t2_1&#34;</span>, <span style=color:#e6db74>&#34;v_t2_2&#34;</span>);
</code></pre></div><p>We can see that the VertexId is the hashed value of the specified ID. If the value corresponding to the identifier is already int64, there is no need to hash or do operations that convert the value to int64.</p><p>Vertex data structure:</p><p><img src=https://user-images.githubusercontent.com/38887077/76483873-24c25480-6453-11ea-8200-41b5bcd61268.png alt=image></p><p>Vertex index structure:</p><p><img src=https://user-images.githubusercontent.com/38887077/76483895-39065180-6453-11ea-8819-820a72c69cc0.png alt=image></p><p>Note: In index, row is the same as  key as the unique identifier of an index.</p><h4 id=storage-structure-of-edges>Storage Structure of Edges</h4><p>The structure of edge index is similar to that of the vertex index.</p><p>Be noted that for the uniqueness of the index key, we use lots of data elements like VertexId, SrcVertexId and Rank to generate them. That is why there is no tag or edge type ID in the index.</p><p>We use the vertex or edge ID to tell specific tag or edge type ID.</p><h5 id=data-structure-of-edges>Data Structure of Edges</h5><p><img src=https://user-images.githubusercontent.com/38887077/76483912-48859a80-6453-11ea-9621-6211ede38953.png alt=image></p><h5 id=index-structure-of-edges>Index Structure of Edges</h5><p><img src=https://user-images.githubusercontent.com/38887077/76483933-53d8c600-6453-11ea-9027-daeae58be38d.png alt=image></p><h3 id=index-binary>Index Binary</h3><p><img src=https://user-images.githubusercontent.com/38887077/76483941-589d7a00-6453-11ea-967f-8cb07f74ead2.png alt=image></p><p>Index binary is the core field of an index. In index binary, there are two types of fields, i.e. fixed-length fields and variable-length fields. Int, double, and bool types are fixed-length fields, and string type is a variable-length field.</p><p>Since <strong>index binary encodes all index columns and stores them together, in order to accurately locate the variable-length fields</strong>, <strong>Nebula Graph</strong> records the length of the variable-length fields with int32 at the end of the index binary.</p><p>For example: Assume an index binary index1 is composed of int column c1, string column c2 and another string column c3:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>index1 <span style=color:#f92672>(</span>c1:int, c2:string, c3:string<span style=color:#f92672>)</span>
</code></pre></div><p>Assume there is a row for index1 where the values of c1, c2, c3 are 23, &ldquo;abc&rdquo;, &ldquo;here&rdquo; respectively, then index1 is stored as follows:</p><ul><li>length = sizeof(&ldquo;abc&rdquo;) = 3</li><li>length = sizeof(&ldquo;here&rdquo;) = 4</li></ul><p><img src=https://user-images.githubusercontent.com/38887077/76482902-9056f280-6450-11ea-8cb6-f18c0c779f8b.png alt=image></p><p>Thus the value of this row is 23abchere34.</p><p>We mentioned at the beginning of this section that index binary contains <code>Variable-length field length</code> field. Then what is it for? Here&rsquo;s an example:</p><p>Now assume there&rsquo;s another index binary index2. It&rsquo;s composed of string column c1, c2 and c3.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>index2 <span style=color:#f92672>(</span>c1:string, c2:string, c3:string<span style=color:#f92672>)</span>
</code></pre></div><p>Suppose we now have two sets of values for c1, c2, and c3:</p><ul><li>row1 : (&ldquo;ab&rdquo;, &ldquo;ab&rdquo;, &ldquo;ab&rdquo;)</li><li>row2: (&ldquo;aba&rdquo;, &ldquo;ba&rdquo;, &ldquo;b&rdquo;)</li></ul><p><img src=https://user-images.githubusercontent.com/38887077/76482907-93ea7980-6450-11ea-9b94-0c029e079d41.png alt=image></p><p>We can see that the prefix of the two rows is the same. How do you distinguish the key of the index binary of the two rows? The answer is <code>Variable-length field length</code>.</p><p><img src=https://user-images.githubusercontent.com/38887077/76482914-9947c400-6450-11ea-8e96-e97bdc541dad.png alt=image></p><p>If your query condition is where c1 == &ldquo;ab&rdquo;, the length of c1 is directly read in the variable-length field length by orders. Based on the length, values of c1 in row1 and row2 are extracted, which are &ldquo;ab&rdquo; and &ldquo;aba&rdquo; respectively. In this way we can accurately determine that only &ldquo;ab&rdquo; in row1 fits the where clause.</p><h3 id=operations-on-indexes>Operations on Indexes</h3><h4 id=index-write>Index write</h4><p>After one or more columns of the Tag / Edge are indexed, if a Tag / Edge write or update operation is involved, the corresponding index must be modified along with the new data. The following will briefly introduce the processing logic of the index write operation in the storage layer:</p><h5 id=inserting>Inserting</h5><p>When inserting vertex / edge, the insertProcessor first determines whether the inserted data contains the same property of a Tag / Edge index. If there is no associated property column index, a new version is generated and the data is put to the Storage Engine; if such an property column index already exists, data and index are written atomically.</p><p><strong>Nebula Graph</strong> then evaluates wether there are staled property values in the current vertex / edge. If so, the staled values are deleted in the atomic operation.</p><h5 id=deleting>Deleting</h5><p>When dropping vertex / edge, deleteProcessor deletes both the data and the index (if any exists), and atomic operations are also required during deletion.</p><h5 id=updating>Updating</h5><p>Updating vertex / edge includes both dropping the old index and inserting a new one. In order to ensure data consistency, atomic operation is needed. While for ordinary data, updating is just an insert operation, and the data of the old version can be overwritten with the latest version of data.</p><h4 id=index-scan>Index scan</h4><p>We use the <code>LOOKUP</code> statement to process index scan in <strong>Nebula Graph</strong>. The <code>LOOKUP</code> statement uses the property value as a judgment to filter all vertices / edges that meet the conditions. The <code>LOOKUP</code> statement also supports <code>WHERE</code> and <code>YIELD</code> clause.</p><h5 id=tips-on-lookup>Tips on LOOKUP</h5><p>As introduced in <a href=#data-storage-structure>Data Storage Structure</a>, index columns are ordered by index creation sequence.</p><p>For example, assume there&rsquo;s a tag (col1, col2) and let&rsquo;s create various indexes for it:</p><ul><li>index1 on tag(col1)</li><li>index2 on tag(col2)</li><li>index3 on tag(col1, col2)</li><li>index4 on tag(col2, col1)</li></ul><p>We can create multiple indexes for col1 and col2, but when scanning the index, the returned results of the above four indexes can be totally different. It&rsquo;s the index optimizer that decides which index to use and generates the optimal execution strategy.</p><p>Based on the above index:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>lookup on tag where tag.col1 <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e># The optimal index is index1</span>
lookup on tag where tag.col2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#75715e># The optimal index is index2</span>
lookup on tag where tag.col1 &gt; <span style=color:#ae81ff>1</span> and tag.col2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
<span style=color:#75715e># Both index3 and index4 are valid while index1 and index2 invalid</span>
</code></pre></div><p>In the third example above, index3 and index4 are both valid, but the optimizer must pick one of them. According to the optimization rules, since tag.col2 == 1 is an <strong>equivalent condition</strong>, therefore, tag.col2 is more efficient, so the optimizer picks index4 as the optimal index.</p><h2 id=nebula-graph-indexing-in-practice>Nebula Graph Indexing in practice</h2><p>If you have any questions regarding the query language syntaxes, please submit a question on our <a href=https://discuss.nebula-graph.io/>forum</a>.</p><h3 id=create-index>Create index</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [(none)]<span style=color:#f92672>&gt;</span> CREATE SPACE my_space(partition_num<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, replica_factor<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>);
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [(none)]<span style=color:#f92672>&gt;</span> USE my_space;
<span style=color:#f92672>--</span> create a graph vertex tag
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> CREATE TAG lookup_tag_1(col1 string, col2 string, col3 string);
<span style=color:#f92672>--</span> create index <span style=color:#66d9ef>for</span> col1, col2, col3
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> CREATE TAG INDEX t_index_1 ON lookup_tag_1(col1, col2, col3);
</code></pre></div><h3 id=drop-index>Drop index</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#f92672>--</span> drop index
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> drop TAG INDEX t_index_1;
Execution succeeded (Time spent: <span style=color:#ae81ff>4.147</span><span style=color:#f92672>/</span><span style=color:#ae81ff>5.192</span> ms)
</code></pre></div><h3 id=rebuild-index>REBUILD index</h3><p>Like most databases,  you can load a bulk of records (vertices and edges) without any index, and rebuild the indices offline after the load, to improve the batch load performance. <strong>Nebula Graph</strong> uses the following command to force the storage rebuild indices again. As you can imagine, this rebuild is a heavy IO operation, and we suggest you not to do it at online serving (at least your system load is low).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>REBUILD {TAG <span style=color:#f92672>|</span> EDGE} INDEX <span style=color:#f92672>&lt;</span>index_name<span style=color:#f92672>&gt;</span> [OFFLINE]
</code></pre></div><h3 id=use-index-with-lookup>Use index with LOOKUP</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#f92672>--</span> insert a graph vertex <span style=color:#ae81ff>200</span>, it has three properties (<span style=color:#e6db74>&#34;col1_200&#34;</span>, <span style=color:#e6db74>&#34;col2_200&#34;</span>, <span style=color:#e6db74>&#34;col3_200&#34;</span>
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> INSERT VERTEX lookup_tag_1(col1, col2, col3) VALUES <span style=color:#ae81ff>200</span><span style=color:#f92672>:</span>(<span style=color:#e6db74>&#34;col1_200&#34;</span>, <span style=color:#e6db74>&#34;col2_200&#34;</span>, <span style=color:#e6db74>&#34;col3_200&#34;</span>),  <span style=color:#ae81ff>201</span><span style=color:#f92672>:</span>(<span style=color:#e6db74>&#34;col1_201&#34;</span>, <span style=color:#e6db74>&#34;col2_201&#34;</span>, <span style=color:#e6db74>&#34;col3_201&#34;</span>), <span style=color:#ae81ff>202</span><span style=color:#f92672>:</span>(<span style=color:#e6db74>&#34;col1_202&#34;</span>, <span style=color:#e6db74>&#34;col2_202&#34;</span>, <span style=color:#e6db74>&#34;col3_202&#34;</span>);
<span style=color:#f92672>--</span> search the vertex by the property
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> LOOKUP ON lookup_tag_1 WHERE lookup_tag_1.col1 <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;col1_200&#34;</span>;
<span style=color:#f92672>============</span>
<span style=color:#f92672>|</span> VertexID <span style=color:#f92672>|</span>
<span style=color:#f92672>============</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>200</span>      <span style=color:#f92672>|</span>
<span style=color:#f92672>------------</span>
<span style=color:#f92672>--</span> find the vertex with its properties.
(user<span style=color:#960050;background-color:#1e0010>@</span><span style=color:#ae81ff>127.0.0.1</span><span style=color:#f92672>:</span><span style=color:#ae81ff>6999</span>) [my_space]<span style=color:#f92672>&gt;</span> LOOKUP ON lookup_tag_1 WHERE lookup_tag_1.col1 <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;col1_200&#34;</span> \
YIELD lookup_tag_1.col1, lookup_tag_1.col2, lookup_tag_1.col3;
<span style=color:#f92672>========================================================================</span>
<span style=color:#f92672>|</span> VertexID <span style=color:#f92672>|</span> lookup_tag_1.col1 <span style=color:#f92672>|</span> lookup_tag_1.col2 <span style=color:#f92672>|</span> lookup_tag_1.col3 <span style=color:#f92672>|</span>
<span style=color:#f92672>========================================================================</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>200</span>      <span style=color:#f92672>|</span> col1_200          <span style=color:#f92672>|</span> col2_200          <span style=color:#f92672>|</span> col3_200          <span style=color:#f92672>|</span>
<span style=color:#f92672>------------------------------------------------------------------------</span>
</code></pre></div><p>This brings the end of the index post. Raise us an issue on <a href=https://github.com/vesoft-inc/nebula>GitHub</a> or give us your feedback on our <a href=https://discuss.nebula-graph.io/>forum</a> if you have any suggestions or requirements.</p><h2 id=you-might-also-like>You might also like</h2><ol><li><a href=https://nebula-graph.io/en/posts/clean-stale-data-with-ttl-in-nebula-graph/>How Nebula Graph Automatically Cleans Stale Data with TTL</a></li><li><a href=https://nebula-graph.io/en/posts/nebula-graph-storage-banlancing-data-migration/>Storage Balance and Data Migration</a></li><li><a href=https://nebula-graph.io/en/posts/nebula-graph-snapshot-introduction/>An Introduction to Snapshot in Nebula Graph</a></li></ol><blockquote class=star-ads><span>Like what we do ? Star us on GitHub.</span>
<a href=https://github.com/vesoft-inc/nebula>https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/nebula-website/en/tags/features>features</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>Share Post</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg>
<span class=st-label>Twitter</span></li><li class=st-custom-button data-network=linkedin><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg>
<span class=st-label>Linkedin</span></li><li class=st-custom-button data-network=facebook><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg>
<span class=st-label>Facebook</span></li><li class=st-custom-button data-network=sharethis><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>Others</span></li></ul></li><li onclick="location.href='\/nebula-website\/en\/posts'"><img src=/images/blog.png>
<a href=/nebula-website/en/posts>Back to blog home</a></li><li onclick="location.href='https:\/\/nebula-graph.io/en/posts/index.xml'"><img src=/images/rss.png>
<a onclick="window.open('https:\/\/nebula-graph.io/en/posts/index.xml')" href>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3><img src=/img/LabelTagIcon.png>Tags</h3><ul class=blog-tags><li class=col-md-12><a href=/nebula-website/en/posts class=active>all</a></li><li><a href=/nebula-website/en/tags/architecture>architecture</a></li><li><a href=/nebula-website/en/tags/community>community</a></li><li><a href=/nebula-website/en/tags/deployment>deployment</a></li><li><a href=/nebula-website/en/tags/dev-log>dev-log</a></li><li><a href=/nebula-website/en/tags/features class=active>features</a></li><li><a href=/nebula-website/en/tags/graph-database>graph-database</a></li><li><a href=/nebula-website/en/tags/performance>performance</a></li><li><a href=/nebula-website/en/tags/query-language>query-language</a></li><li><a href=/nebula-website/en/tags/release-notes>release-notes</a></li><li><a href=/nebula-website/en/tags/system-testing>system-testing</a></li><li><a href=/nebula-website/en/tags/tools>tools</a></li><li><a href=/nebula-website/en/tags/use-cases>use-cases</a></li></ul></div><div class=blog-anchors><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#why-indexing-is-needed-in-a-graph-database>Why indexing is needed in a graph database</a></li><li><a href=#core-concepts-to-understand-nebula-graph-indexing>Core concepts to understand Nebula Graph indexing</a></li><li><a href=#whats-required-for-indexing-in-a-graph-database>What&rsquo;s required for indexing in a graph database</a></li><li><a href=#how-indexes-are-stored-in-nebula-graph>How indexes are stored in Nebula Graph</a></li><li><a href=#indexing-logic-breakdown>Indexing logic breakdown</a><ul><li><a href=#storage-structure-data-vs-indexes>Storage Structure: Data vs Indexes</a></li><li><a href=#index-binary>Index Binary</a></li><li><a href=#operations-on-indexes>Operations on Indexes</a></li></ul></li><li><a href=#nebula-graph-indexing-in-practice>Nebula Graph Indexing in practice</a><ul><li><a href=#create-index>Create index</a></li><li><a href=#drop-index>Drop index</a></li><li><a href=#rebuild-index>REBUILD index</a></li><li><a href=#use-index-with-lookup>Use index with LOOKUP</a></li></ul></li><li><a href=#you-might-also-like>You might also like</a></li></ul></nav></div><div class=social-share><h3>Share Post</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=WeiBo data-toggle=modal target=_blank data-target>WeiBo</a></li><li><img src=/img/gongzhonghao.png>
<a href title="Official Accounts" data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>Official Accounts</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>WeChat</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><div id=J-star-popup class=nebula-star-popup></div><script src=/nebula-website/js/jquery.js></script><script src=/nebula-website/js/bootstrap.min.js></script><script src=/nebula-website/js/jquery.easing.min.js></script><script src=/nebula-website/js/jquery.fittext.js></script><script src=/nebula-website/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/nebula-website/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/nebula-website/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"\/nebula-website\/en\/posts\/how-indexing-works-in-nebula-graph\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script></body></html><script>if(!sessionStorage.getItem("popupIsRemove")){$("#top").css("padding-top","98px")}</script>