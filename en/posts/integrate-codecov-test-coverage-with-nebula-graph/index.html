<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="Integrating Codecov Test Coverage With Nebula Graph"><meta property="twitter:title" content="Integrating Codecov Test Coverage With Nebula Graph"><meta name=twitter:description content="In this post, we will introduce to you how Nebula Graph, a distributed graph database, performs test coverage with Codecov."><meta name=og:description content="In this post, we will introduce to you how Nebula Graph, a distributed graph database, performs test coverage with Codecov."><meta name=twitter:image content="/nebula-website/en/posts/integrate-codecov-test-coverage-with-nebula-graph/Medium_hu28b38faa3da7d7ebd1cd6f4918240a05_240919_600x0_resize_box_2.png"><meta name=og:image content="/nebula-website/en/posts/integrate-codecov-test-coverage-with-nebula-graph/Medium_hu28b38faa3da7d7ebd1cd6f4918240a05_240919_600x0_resize_box_2.png"><meta name=description content="In this post, we will introduce to you how Nebula Graph, a distributed graph database, performs test coverage with Codecov."><meta name=generator content="Hugo 0.65.3"><title>Integrating Codecov Test Coverage With Nebula Graph</title><link rel="shortcut icon" href=/nebula-website/favicon.ico><link rel=stylesheet href=/nebula-website/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/nebula-website/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/creative.css type=text/css><link rel=stylesheet href=/nebula-website/css/modals.css type=text/css><link rel=stylesheet href=/nebula-website/css/animate.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/nebula-website/js/jquery.js></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPJVFGH');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPJVFGH" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=nav-popup id=nav-popup><img src=/images/popup.png><img src=/images/popup.png> Nebula Graph RC4 is released! <a href=https://github.com/vesoft-inc/nebula/releases/tag/v1.0.0-rc4 target=_blank>Get Started</a> <img src=/images/shut.png id=shut onclick=shut()></div><div class=container-fluid><div class=navbar-header><div class=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/nebula-website/en/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>Docs</a></li><li class=active><a href=/en/posts target>Blog</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><a href=#contact_us target onclick=contactUsClick()>Contact Us</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank onclick="gtag('event','Button Click',{event_category:'Engagement',event_label:'Nebula Studio'})">Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}
function shut(){$('#nav-popup').remove();$("#top").css("padding-top","50px")
sessionStorage.setItem("popupIsRemove",true);}
if(!sessionStorage.getItem("popupIsRemove")){$("#nav-popup").css("display","block")}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><div class=blog-left-aside><div class=social-share id=J_Share><h3>Share</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div><section class=blog-content><h1>Integrating Codecov Test Coverage With Nebula Graph</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>Shylock</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2020-04-21</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/nebula-website/en//tags/dev-log>dev-log</a><a href=/nebula-website/en//tags/features>features</a></div></div><p><img src=https://user-images.githubusercontent.com/57335825/79863885-17fa2e80-840b-11ea-86a7-648626742972.png alt="Integrating Codecov Test Coverage With Nebula Graph"></p><p>A solid testing strategy is a key point to the successful adoption of agile development. Test coverage is a metric used to measure how much of the source code of a program is executed by running a set of tests. It helps developers to identify the code in their application that was not tested.</p><p>Ideally, tests against software should define all behaviors of the software. However, this is rarely realized. That is how test coverage comes into play.</p><p>Test coverage is a visual measurement used to express which lines of code were executed by a test suite. This helps the software developers too locate where they should write new test cases to cover their source code completely.</p><p>In this post, we will introduce to you how Nebula Graph, a distributed graph database, performs test coverage.</p><h2 id=collect-information-for-test-coverage>Collect Information for Test Coverage</h2><p>Nebula Graph is mainly developed in C++. And it supports most Linux environments and gcc/clang compilers. Thus through the support provided by these tool chains, we can easily perform coverage analysis in Nebula Graph.</p><p>Both gcc and clang support gcov-style test coverage, which is also very simple to use. The main steps are as follows:</p><ol><li>Add compilation option <code>--coverage -O0 -g</code></li><li>Add link option <code>--coverage</code></li><li>Run the test</li><li>Integrate the test coverage report with lcov. For example <code>lcov --capture --directory . --output-file coverage.info</code></li><li>Filter out coverage data for files that we aren&rsquo;t interested in. For example <code>lcov --remove coverage.info '*/opt/vesoft/*' -o clean.info</code></li></ol><p>By now the test coverage information has been successfully collected.</p><p>Next, you can generate a report through a tool such as genhtml and view the test coverage through your browser. See an example below:</p><p><img src=https://user-images.githubusercontent.com/57335825/79864195-a078cf00-840b-11ea-8f2a-9901d120451b.png alt="test coverage report sample"></p><p>But generating reports manually is very tedious. It is not automatic, and you have to perform such operations manually every time in the continuous development process. So the common practice is to set up code coverage for tests in CI and integrate with the third-party platforms (such as codecov, coveralls).</p><p>By doing so, developers do not have to care about the collection and report of test coverage, they only need to check the test coverage on the third-party platforms after committing their code.</p><p>What&rsquo;s more, some third-party tools support integrating the test report with pull requests, which is very convenient.</p><h2 id=integrate-with-ci-github-action>Integrate with CI Github Action</h2><p>There are many mainstream CI platforms, such as Travis, azure-pipelines and GitHub Action. Nebula Graph selects GitHub Action. In our previous post <a href=https://nebula-graph.io/en/posts/github-action-automating-project-process/><em>Automating Your Project Processes with Github Actions</em></a>, we have introduced GitHub Action in detail, you may take a look at it to gain some basic understanding about Action.</p><p>Compared with other CI platforms, GitHub Action integrates better with GitHub and supports many operating systems and CPUs.</p><p>Furthermore, Action is powerful, simple and easy to use. The following example config a test coverage job in the workflow file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#66d9ef>name</span>: CMake with Coverage
  <span style=color:#66d9ef>if</span>: matrix.compiler == <span style=color:#e6db74>&#39;gcc-9.2&#39;</span> <span style=color:#75715e>&amp;&amp;</span> matrix.os == <span style=color:#e6db74>&#39;centos7&#39;</span>
  <span style=color:#66d9ef>run</span>: <span style=color:#e6db74>|
</span><span style=color:#e6db74>    cmake -DENABLE_COVERAGE=ON -B build/</span>
</code></pre></div><p>We can see that here we manage the coverage-related compilation options introduced above through a cmake option, which easily enables and disables the collection of coverage information.</p><p>For example, developers usually turn off coverage during development process, compilation, and testing to avoid the extra cost of compiling and running tests.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#66d9ef>name</span>: Testing Coverage Report
  <span style=color:#66d9ef>working-directory</span>: build
  <span style=color:#66d9ef>if</span>: success() <span style=color:#75715e>&amp;&amp;</span> matrix.compiler == <span style=color:#e6db74>&#39;gcc-9.2&#39;</span> <span style=color:#75715e>&amp;&amp;</span> matrix.os == <span style=color:#e6db74>&#39;centos7&#39;</span>
  <span style=color:#66d9ef>run</span>: <span style=color:#e6db74>|
</span><span style=color:#e6db74>    set -e</span>
    /usr/local/bin/lcov --version
    /usr/local/bin/lcov --capture --gcov-tool $GCOV --directory . --output-file coverage.info
    /usr/local/bin/lcov --remove coverage.info <span style=color:#e6db74>&#39;*/opt/vesoft/*&#39;</span> -o clean.info
    bash &lt;(curl -s https://codecov.io/bash) -Z -f clean.info
</code></pre></div><p>The piece of code here collects, merges and uploads the test reports to the third-party platform. This has been described in detail in the previous section. The operation of CI is shown in the following figure:</p><p><img src=https://user-images.githubusercontent.com/57335825/79864311-d9b13f00-840b-11ea-88ad-30b5f1fca4a9.png alt="CI operation"></p><h2 id=test-coverage-platform-codecov>Test Coverage Platform Codecov</h2><p>Nebula Graph selected Codecov, a test result analysis tool, as its test coverage platform. For GitHub Action, it mainly executes the above script in CI and uploads the produced data to Codecov.</p><p>First sign up/in on <a href=https://docs.codecov.io/>Codecov</a>, click &lsquo;Add new repository&rsquo;, choose the repository we want to apply the coverage for, and get an accessible token.</p><p>Use this token in your API requests, the coverage files can be uploaded to Codecov Details on API see the <a href=https://docs.codecov.io/reference#upload>Upload Doc</a>.</p><p>In addition to uploading reports, there are also APIs that list the pull requests or commits. You can customize your automated tools based on them.</p><p>Then you can view the test coverage information. For example, you can see Nebula Graph test coverage <a href=https://codecov.io/gh/vesoft-inc/nebula>here</a>.</p><p>Moreover, you can check the test coverage in different directories through the pie chart:</p><p><img src=https://user-images.githubusercontent.com/57335825/79864433-0c5b3780-840c-11ea-91e1-22c544983c68.png alt="test coverage result chart"></p><p>You can also open a specific file to see which lines are covered or not:</p><p><img src=https://user-images.githubusercontent.com/57335825/79864551-39a7e580-840c-11ea-9c9d-5fb3c37a2a50.png alt="test coverage results by code lines"></p><p>However, we use a CLI tool provided by Codecov instead of the APIs.</p><p>For example we use <code>bash &lt;(curl -s https://codecov.io/bash) -Z -t &lt;token>- f clean.info</code> to upload reports. The token here is the authentication token provided by Codecov. Set it as an environment variable <code>CODECOV_TOKEN</code> instead of inputting the plaintext token here.</p><p>Through the above operations, you can not only view the test coverage of your project on Codecov, but also see the coverage change if this pr is merged, which is convenient for gradually increasing test coverage.</p><p>Finally, you can also add the Codecov coverage badge in your README file just like <a href=https://github.com/vesoft-inc/nebula>Nebula Graph</a>.</p><p><img src=https://user-images.githubusercontent.com/57335825/79864632-50e6d300-840c-11ea-8a79-c7ad53bdd03f.png alt="add test coverage result to your repo"></p><h2 id=you-might-also-like>You might also like</h2><ol><li><a href=https://nebula-graph.io/en/posts/nebula-graph-architecture-overview/>Nebula Graph Architecture — A Bird’s View</a></li><li><a href=https://nebula-graph.io/en/posts/github-action-automating-project-process/>Automating Your Project Processes with Github Actions</a></li><li><a href=https://nebula-graph.io/en/posts/segmentation-fault-gcc-illegal-instruction-trouble-shooting/>Compiling Trouble Shooting: Segmentation Fault and GCC Illegal Instruction</a></li></ol><blockquote><p>_Hi, I&rsquo;m Shylock. a software engineer at Nebula Graph. Hope my post is of help to you. Please let me know if you have any ideas about this. Thanks!_</p></blockquote><blockquote class=star-ads><span>Like what we do ? Star us on GitHub.</span>
<a href=https://github.com/vesoft-inc/nebula onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via blogbody'});">https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/nebula-website/en/tags/dev-log>dev-log</a>
<a href=/nebula-website/en/tags/features>features</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>Share</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg>
<span class=st-label>Twitter</span></li><li class=st-custom-button data-network=linkedin><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg>
<span class=st-label>Linkedin</span></li><li class=st-custom-button data-network=facebook><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg>
<span class=st-label>Facebook</span></li><li class=st-custom-button data-network=sharethis><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>Others</span></li></ul></li><li onclick="location.href='\/nebula-website\/en\/posts'"><img src=/images/blog.png>
<a href=/nebula-website/en/posts>Back to blog home</a></li><li onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'RSS via blogbody'});window.open('https:\/\/nebula-graph.io/en/posts/index.xml');"><img src=/images/rss.png>
<a href=javascript:void(0);>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3><img src=/img/LabelTagIcon.png>Tags</h3><ul class=blog-tags><li class=col-md-12><a href=/nebula-website/en/posts class=active>all</a></li><li><a href=/nebula-website/en/tags/architecture>architecture</a></li><li><a href=/nebula-website/en/tags/community>community</a></li><li><a href=/nebula-website/en/tags/deployment>deployment</a></li><li><a href=/nebula-website/en/tags/dev-log class=active>dev-log</a></li><li><a href=/nebula-website/en/tags/features class=active>features</a></li><li><a href=/nebula-website/en/tags/graph-database>graph-database</a></li><li><a href=/nebula-website/en/tags/performance>performance</a></li><li><a href=/nebula-website/en/tags/query-language>query-language</a></li><li><a href=/nebula-website/en/tags/release-notes>release-notes</a></li><li><a href=/nebula-website/en/tags/system-testing>system-testing</a></li><li><a href=/nebula-website/en/tags/tools>tools</a></li><li><a href=/nebula-website/en/tags/use-cases>use-cases</a></li></ul></div><div class=blog-anchors id=J_Anchor><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#collect-information-for-test-coverage>Collect Information for Test Coverage</a></li><li><a href=#integrate-with-ci-github-action>Integrate with CI Github Action</a></li><li><a href=#test-coverage-platform-codecov>Test Coverage Platform Codecov</a></li><li><a href=#you-might-also-like>You might also like</a></li></ul></nav></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=WeiBo data-toggle=modal target=_blank data-target>WeiBo</a></li><li><img src=/img/gongzhonghao.png>
<a href title="Official Accounts" data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>Official Accounts</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>WeChat</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><script src=/nebula-website/js/jquery.js></script><script src=/nebula-website/js/bootstrap.min.js></script><script src=/nebula-website/js/jquery.easing.min.js></script><script src=/nebula-website/js/jquery.fittext.js></script><script src=/nebula-website/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/nebula-website/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/nebula-website/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"\/nebula-website\/en\/posts\/integrate-codecov-test-coverage-with-nebula-graph\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script><script src=/nebula-website/js/anchor.js></script></body></html><script>if(!sessionStorage.getItem("popupIsRemove")){$("#top").css("padding-top","98px")}</script>