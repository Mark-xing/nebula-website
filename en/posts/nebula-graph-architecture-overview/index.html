<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="Nebula Graph Architecture — A Bird’s View"><meta property="twitter:title" content="Nebula Graph Architecture — A Bird’s View"><meta name=twitter:description content="Nebula Graph is an open-source, distributed, highly performant graph database. This article explains its technical architecture in detail."><meta name=og:description content="Nebula Graph is an open-source, distributed, highly performant graph database. This article explains its technical architecture in detail."><meta name=twitter:image content="https://nebula-graph.io/en/posts/nebula-graph-architecture-overview/Nebula%20architecture%200_huec89f1fb46cc083a799871ebfe4e164d_147922_600x0_resize_q75_box.jpg"><meta name=og:image content="https://nebula-graph.io/en/posts/nebula-graph-architecture-overview/Nebula%20architecture%200_huec89f1fb46cc083a799871ebfe4e164d_147922_600x0_resize_q75_box.jpg"><meta name=description content="Nebula Graph is an open-source, distributed, highly performant graph database. This article explains its technical architecture in detail."><meta name=generator content="Hugo 0.65.3"><title>Nebula Graph Architecture — A Bird’s View</title><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/css/creative.css type=text/css><link rel=stylesheet href=/css/modals.css type=text/css><link rel=stylesheet href=/css/animate.min.css type=text/css><link rel=stylesheet href=/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/js/jquery.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=container-fluid><div class=navbar-header><div class=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>Docs</a></li><li><a href=/en/posts target>Blog</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><a href=#contact_us target onclick=contactUsClick()>Contact Us</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank>Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><section class=blog-content><h1>Nebula Graph Architecture — A Bird’s View</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>Sherman</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2019-12-24</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/en//tags/Architecture>Architecture</a></div></div><p>Nebula Graph is an <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=11&cad=rja&uact=8&ved=2ahUKEwjzv7Lz1I7oAhWIF6YKHf0GACMQFjAKegQIAxAB&url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FOpen-source_software&usg=AOvVaw3nuNCAdMBWuqtIiKIk4wRU">open-source</a> distributed graph database solution. So as an open-source project, we&rsquo;d like those who are interested in graph databases to know as much as possible how Nebula Graph is designed and why it is a highly performant database.</p><p>That&rsquo;s how this series of architecture articles have come into play. We are going to cover the following three areas in this series:</p><ol><li>A high-level overview of the architecture of Nebula Graph, which is what this article is going to talk about</li><li>How Nebula Graph&rsquo;s storage engine works</li><li>How Nebula Graph&rsquo;s query engine works, including the way we have designed nQGL, our graph query language</li></ol><h2 id=nebula-graph-architecture-diagram>Nebula Graph Architecture Diagram</h2><p><img src=https://user-images.githubusercontent.com/38887077/76277232-1ba27d80-62c3-11ea-9389-cc1aca329c7b.png alt=image></p><p>Seen from the diagram above, a fully deployed Nebula Graph cluster contains three services:</p><ul><li>Meta Service</li><li>Query Service</li><li>Storage Service</li></ul><p>Each service has its own executable binary. These <a href=https://github.com/vesoft-inc/nebula/releases>binaries</a> can be deployed either on the same set of hosts or on different hosts.</p><p>We will explain in detail how each service works below.</p><h3 id=meta-service>Meta Service</h3><p>On the right side of the architecture picture, it shows a cluster of Meta Service.</p><p><img src=https://user-images.githubusercontent.com/38887077/76277238-1e9d6e00-62c3-11ea-9d10-8391c26b0b20.png alt=image></p><p>The Meta Service follows a leader/follower architecture.</p><p>The leader is elected by all Meta Service hosts in the cluster and serves all traffic. Followers stand by and take the updates replicated from the leader.</p><p>Once the leader dies, one of the followers will be re-elected as the new leader.</p><p>The Meta Service not only stores and provides meta information about the graph, such as schema and graph partition information, but also takes the role of the coordinator to orchestra the data movement and to force the leader shift.</p><h3 id=separation-of-query-and-storage-layers>Separation of Query and Storage Layers</h3><p><img src=https://user-images.githubusercontent.com/38887077/76277242-2230f500-62c3-11ea-8566-4b6be458adee.png alt=image></p><p>To the left of the Meta Service is Nebula Graph&rsquo;s main services.</p><p>Nebula Graph divides the query execution and the graph storage into two separate services. Above the dotted line is the Query Service, and below the dotted line is the Storage Service.</p><p>The separation has several benefits：</p><ul><li>The most straightforward one is that the query layer and storage layer can be expanded or shrunk independently.</li><li>The separation also makes the linear horizontal expansion possible.</li><li>Last but not the least, the separation provides an opportunity to make it possible for the Storage Service to serve multiple computation layers.</li></ul><p>The current Query Service can be considered as a high-priority computation layer, while an iterative computation framework could be another one.</p><h3 id=stateless-query-layer>Stateless Query Layer</h3><p><img src=https://user-images.githubusercontent.com/38887077/76277245-25c47c00-62c3-11ea-912b-5de3ce4e18fe.png alt=image></p><p>Now let&rsquo;s look at the Query Service.</p><p>Each individual Query Service host runs a stateless query engine. The Query Service hosts will never communicate with each other. They only read the meta information from the Meta Service and interact with Storage Service.</p><p>This design makes sure the Query Service cluster can be easily managed by Kubernetes (aka. k8s) or be deployed on the cloud, which by the way is already available for Nebula Graph. See <a href=https://nebula-graph.io/en/posts/how-to-deploy-nebula-graph-in-kubernetes/>how to deploy Nebula Graph on Kubernetes</a>.</p><p>There are two ways to balance the Query Service load：</p><ol><li>The most common way is to place a <a href=https://nebula-graph.io/en/posts/nebula-graph-storage-banlancing-data-migration/>load balancer</a> in front of Query Service.</li><li>The second way is to configure the client library with all Query Service hosts&rsquo; IP addresses. The client will randomly pick one to connect.</li></ol><p>Each query engine takes the request from the client, parses the statement, and generates an Abstract Syntax Tree (AST). Then the AST will be handed over to the execution planner and the optimizer. The final AST will be passed to the executors.</p><p>Below is a flow chart of how Nebula Graph&rsquo;s query engine works.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/570133/1583735687478-5fa774fc-d8a3-494d-b371-881c3be62e0f.png#align=left&display=inline&height=2456&name=image.png&originHeight=2456&originWidth=1128&size=273422&status=done&style=none&width=1128" alt=image.png>For a detailed explanation, please refer to <a href=https://nebula-graph.io/en/posts/nebula-graph-query-engine-overview/>the introduction to the query engine</a>.</p><h3 id=shared-nothing-distributed-storage-layer>Shared-nothing Distributed Storage Layer</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/570133/1583737841037-6197825a-bab8-4e1e-8337-15a6f8fbecdd.png#align=left&display=inline&height=622&name=Storage%20service%20diagram.png&originHeight=622&originWidth=1622&size=219570&status=done&style=none&width=1622" alt="Storage service diagram.png"></p><p>The Storage Service is designed to be a <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=8&cad=rja&uact=8&ved=2ahUKEwiL6PP244zoAhWsKqYKHYTcAuwQFjAHegQIERAG&url=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FShared-nothing_architecture&usg=AOvVaw0G_g2cF507bZFtmozux0Ua">shared-nothing distributed architecture</a>. Each storage host has multiple local key/value stores as the physical data storage.</p><p>A quorum consensus protocol (we chose <a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwiojOrR5IzoAhWqxIsBHeqHDbUQFjAAegQIARAB&url=https%3A%2F%2Fraft.github.io%2F&usg=AOvVaw0gbPkPuRwWu0Kd74PJmOzK">RAFT</a> over paxos due to its simplicity) is built on top of the key/value stores. Together, they provide a distributed key/value store.</p><p>On top of this distributed key/value store, a graph semantic layer is provided to translate the graph operations into key/value operations.</p><p>The graph data (vertices and edges) are hashed into multiple partitions by the rule (vertex_id % the_number_of_partitions).</p><p>A partition is a virtual set of data in Nebula Graph. These partitions are allocated to all storage hosts. The allocation information is stored in the Meta Service and can be accessed by storage hosts and query hosts.</p><h2 id=conclusion>Conclusion</h2><p>This post aims to provide a bird&rsquo;s view on Nebula Graph&rsquo;s architecture so that you have a basic understanding of how a distributed graph database works. </p><p>For detailed introduction to the major components of the system, please refer to:</p><ul><li><a href=https://nebula-graph.io/en/posts/nebula-graph-storage-engine-overview/>An introduction to Nebula Graph&rsquo;s Storage Engine</a></li><li><a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwiojOrR5IzoAhWqxIsBHeqHDbUQFjAAegQIARAB&url=https%3A%2F%2Fraft.github.io%2F&usg=AOvVaw0gbPkPuRwWu0Kd74PJmOzK">An Introduction to Nebula Graph&rsquo;s Query Engine</a></li></ul><p>If you have anything to share about distributed systems or graph databases, please feel free to leave us a comment below. We look forward to hear from you.</p><blockquote class=star-ads><span>Do you like this post? If yes, just give me a</span>
<span class="glyphicon glyphicon-star"></span><span>star:</span>
<a href=https://github.com/vesoft-inc/nebula>https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/en/tags/Architecture>Architecture</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>Share Post</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg>
<span class=st-label>Twitter</span></li><li class=st-custom-button data-network=linkedin><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg>
<span class=st-label>Linkedin</span></li><li class=st-custom-button data-network=facebook><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg>
<span class=st-label>Facebook</span></li><li class=st-custom-button data-network=sharethis><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>Others</span></li></ul></li><li onclick="location.href='\/en\/posts'"><img src=/images/blog.png>
<a href=/en/posts>Back to blog home</a></li><li onclick="location.href='https:\/\/nebula-graph.io/en/posts/index.xml'"><img src=/images/rss.png>
<a onclick="window.open('https:\/\/nebula-graph.io/en/posts/index.xml')" href>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3 class="glyphicon glyphicon-tag">Tags</h3><ul class=blog-tags><li class=col-md-12><a href=/en/posts class=active>All</a></li><li><a href=/en/tags/architecture class=active>architecture</a></li><li><a href=/en/tags/community>community</a></li><li><a href=/en/tags/deployment>deployment</a></li><li><a href=/en/tags/dev-log>dev-log</a></li><li><a href=/en/tags/features>features</a></li><li><a href=/en/tags/graph-database>graph-database</a></li><li><a href=/en/tags/graph-query-language>graph-query-language</a></li><li><a href=/en/tags/performance>performance</a></li><li><a href=/en/tags/release-notes>release-notes</a></li><li><a href=/en/tags/system-testing>system-testing</a></li><li><a href=/en/tags/tools>tools</a></li><li><a href=/en/tags/use-cases>use-cases</a></li></ul></div><div id=blog-carousel class="carousel slide" data-ride=carousel><ol class=carousel-indicators><li data-target=#blog-carousel data-slide-to=0 class=active></li><li data-target=#blog-carousel data-slide-to=1></li></ol><div class=carousel-inner role=listbox><div class="item active" onclick="location.href='\/en\/posts\/clean-stale-data-with-ttl-in-nebula-graph_\/'"><img src=https://user-images.githubusercontent.com/38887077/77512987-09256800-6eaf-11ea-9b41-e8b87ab51fe8.png alt="How Nebula Graph Automatically Cleans Stale Data with TTL" width=220px height=150px><div class=carousel-caption>How Nebula Graph Automatically Cleans Stale Data with TTL</div></div><div class=item onclick="location.href='\/en\/posts\/github-action-automating-project-process\/'"><img src=https://user-images.githubusercontent.com/38887077/76831941-482a3c80-6863-11ea-9795-009eaa50fc0e.png alt="Automating Your Project Processes with Github Actions" width=220px height=150px><div class=carousel-caption>Automating Your Project Processes with Github Actions</div></div></div><a class="left carousel-control" href=#blog-carousel role=button data-slide=prev><span class="glyphicon glyphicon-chevron-left" aria-hidden=true></span><span class=sr-only>Previous</span></a>
<a class="right carousel-control" href=#blog-carousel role=button data-slide=next><span class="glyphicon glyphicon-chevron-right" aria-hidden=true></span><span class=sr-only>Next</span></a></div><div class=blog-anchors><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#nebula-graph-architecture-diagram>Nebula Graph Architecture Diagram</a><ul><li><a href=#meta-service>Meta Service</a></li><li><a href=#separation-of-query-and-storage-layers>Separation of Query and Storage Layers</a></li><li><a href=#stateless-query-layer>Stateless Query Layer</a></li><li><a href=#shared-nothing-distributed-storage-layer>Shared-nothing Distributed Storage Layer</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class=social-share><h3>Share Post</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><p align=center class=statement>Nebula Graph will respect your data privacy per our Privacy Policy</p><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=WeiBo data-toggle=modal target=_blank data-target>WeiBo</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/gongzhonghao.png>
<a href title="Official Accounts" data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>Official Accounts</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>WeChat</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><div id=J-star-popup class=nebula-star-popup></div><script src=/js/jquery.js></script><script src=/js/bootstrap.min.js></script><script src=/js/jquery.easing.min.js></script><script src=/js/jquery.fittext.js></script><script src=/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"https:\/\/nebula-graph.io\/en\/posts\/nebula-graph-architecture-overview\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script></body></html>