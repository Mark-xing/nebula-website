<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Nebula Graph"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@NebulaGraph"><meta name=twitter:creator content="@NebulaGraph"><meta name=twitter:domain content="nebula-graph.io"><meta name=twitter:title content="An Introduction to Snapshot in Nebula Graph"><meta property="twitter:title" content="An Introduction to Snapshot in Nebula Graph"><meta name=twitter:description content="Nebula Graph supports creating cluster snapshots to rebuild cluster and reimport data upon failures. This article introduces its design."><meta name=og:description content="Nebula Graph supports creating cluster snapshots to rebuild cluster and reimport data upon failures. This article introduces its design."><meta name=twitter:image content="/nebula-website/en/posts/nebula-graph-snapshot-introduction/snapshot_hu270b2c6356d0605f9ebafe12b591e8d2_243226_600x0_resize_q75_box.jpeg"><meta name=og:image content="/nebula-website/en/posts/nebula-graph-snapshot-introduction/snapshot_hu270b2c6356d0605f9ebafe12b591e8d2_243226_600x0_resize_q75_box.jpeg"><meta name=description content="Nebula Graph supports creating cluster snapshots to rebuild cluster and reimport data upon failures. This article introduces its design."><meta name=generator content="Hugo 0.65.3"><title>An Introduction to Snapshot in Nebula Graph</title><link rel="shortcut icon" href=/nebula-website/favicon.ico><link rel=stylesheet href=/nebula-website/css/bootstrap.min.css type=text/css><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel=stylesheet type=text/css><link href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" rel=stylesheet type=text/css><link rel=stylesheet href=/nebula-website/font-awesome/css/font-awesome.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/creative.css type=text/css><link rel=stylesheet href=/nebula-website/css/modals.css type=text/css><link rel=stylesheet href=/nebula-website/css/animate.min.css type=text/css><link rel=stylesheet href=/nebula-website/css/custom/index.css type=text/css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><script src=/nebula-website/js/jquery.js></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPJVFGH');</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-60523578-5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-60523578-5');</script></head><body id=page-top><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPJVFGH" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><nav id=mainNav class="navbar navbar-default navbar-fixed-top"><div class=nav-popup id=nav-popup><img src=/images/popup.png><img src=/images/popup.png> Nebula Graph RC4 is released! <a href=https://github.com/vesoft-inc/nebula/releases/tag/v1.0.0-rc4 target=_blank>Get Started</a> <img src=/images/shut.png id=shut onclick=shut()></div><div class=container-fluid><div class=navbar-header><div class=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-icon=octicon-star data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></div><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class="navbar-brand page-scroll" href=/nebula-website/en/></a></div><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav" id=nav><li class=github-star id=github-star onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via Navi'})"><a class=github-button href=https://github.com/vesoft-inc/nebula data-size=large data-show-count=true aria-label="Star vesoft-inc/nebula on GitHub">Star</a></li><li><a href=https://docs.nebula-graph.io/ target=_blank>Docs</a></li><li class=active><a href=/en/posts target>Blog</a></li><li><a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><a href=#contact_us target onclick=contactUsClick()>Contact Us</a></li><li class="dropdown navbar-right"><a class=dropdown-toggle data-toggle=dropdown href=# role=button aria-haspopup=true aria-expanded=false><img src=/images/language120x120.png>
<span class=caret></span></a><ul class=dropdown-menu><li class=nav-item><a class=dropdown-item href=/en target>English</a></li><li class=nav-item><a class=dropdown-item href=/cn target>中文</a></li></ul></li><li id=navbar-right><a href=https://github.com/vesoft-inc/nebula-web-docker target=_blank onclick="gtag('event','Button Click',{event_category:'Engagement',event_label:'Nebula Studio'})">Nebula Studio</a></li></ul></div></div></nav><script>function contactUsClick(){$('html,body').animate({scrollTop:document.documentElement.scrollHeight},800)
return false;}
function shut(){$('#nav-popup').remove();$("#top").css("padding-top","50px")
sessionStorage.setItem("popupIsRemove",true);}
if(!sessionStorage.getItem("popupIsRemove")){$("#nav-popup").css("display","block")}</script><main id=top class=blog-detail><div class=wrapper><div class=inner><div class=blog-left-aside><div class=social-share id=J_Share><h3>Share Post</h3><div class=nebula-share-buttons><div class="st-custom-button st-remove-label" data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg></div><div class="st-custom-button st-remove-label" data-network=linkedin><img alt="linkedin-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg></div><div class="st-custom-button st-remove-label" data-network=facebook><img alt="facebook-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg></div><div class="st-custom-button st-remove-label" data-network=hackernews><img alt="hackernews-white sharing button" src=https://platform-cdn.sharethis.com/img/hackernews-white.svg></div><div class="st-custom-button st-remove-label" data-network=reddit><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/reddit-white.svg></div><div class="st-custom-button st-remove-label" data-network=sharethis><img alt="reddit-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg></div></div></div></div><section class=blog-content><h1>An Introduction to Snapshot in Nebula Graph</h1><div class=blog-metas><div class=meta><img src=/images/writer.png width=16px height=16px>
<span>sky</span></div><div class=meta><img src=/images/calendar.png width=16px height=16px>
<span>2020-01-21</span></div><div class="tags meta"><img src=/images/tag.png width=16px height=16px>
<a href=/nebula-website/en//tags/features>features</a></div></div><h2 id=1-overview>1. Overview</h2><h3 id=11-terms>1.1 Terms</h3><table><thead><tr><th>Names</th><th>Descriptions</th></tr></thead><tbody><tr><td>Storage Engine</td><td><strong>Nebula Graph</strong>&lsquo;s smallest physical storage unit, currently supports RocksDB and Hbase, this document is only for RocksDB.</td></tr><tr><td>Partition</td><td><strong>Nebula Graph</strong>&lsquo;s smallest logical storage unit. A StorageEngine contains multiple partitions. A partition is divided into a leader and multiple followers, and Raft protocol is used to ensure data consistency between the leader and the followers.</td></tr><tr><td>Graph Space</td><td>Each graph space is an isolated graph unit that has its own tags and edges. A <strong>Nebula Graph</strong> cluster contains many graph spaces.</td></tr><tr><td>checkpoint</td><td>Checkpoints can be used as a point in time snapshot for the storage engine. Checkpoint can be used for full backup. Checkpoint file is a hard link for the sst file.</td></tr><tr><td>snapshot</td><td>The snapshot in this document refers to a snapshot that captures a point-in-time view of <strong>Nebula Graph</strong> cluster, i.e. a collection of the checkpoints for all the storage engines in the cluster. A cluster can be restored to the state when a certain snapshot is created via the snapshot.</td></tr><tr><td>wal</td><td>Write-ahead Log (wal) is used by Raft to ensure the consistency between leaders and followers.</td></tr></tbody></table><h3 id=12-background>1.2 Background</h3><p>In production, <strong>Nebula Graph</strong> handles massive data and high frequency business requests, therefore, faults caused by human, hardware or processing are inevitable. Some fatal faults even lead to abnormal operation or data failure in the cluster. When such situation occurs, rebuilding cluster and reimporting data becomes rather time-consuming.</p><p>As a solution to this problem, <strong>Nebula Graph</strong> supports creating snapshot for the clusters. You first create a snapshot then use it to to restore the cluster to an available state when catastrophic failures take place.</p><h2 id=2-architecture>2. Architecture</h2><h3 id=21-architecture-overview>2.1 Architecture Overview</h3><p><img src=https://user-images.githubusercontent.com/56643819/70290011-89955f80-1811-11ea-8a15-a898ec902fd4.png alt=image></p><h3 id=22-storage-system-structure>2.2 Storage System Structure</h3><p><img src=https://user-images.githubusercontent.com/56643819/70290034-99ad3f00-1811-11ea-97dd-f6a814c5624d.png alt=image></p><h3 id=23-storage-system-file-structure>2.3 Storage System File Structure</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>bright2star@hp-server storage<span style=color:#f92672>]</span>$ tree
.
└── nebula
    └── <span style=color:#ae81ff>1</span>
        ├── checkpoints
        │   ├── SNAPSHOT_2019_12_04_10_54_42
        │   │   ├── data
        │   │   │   ├── 000006.sst
        │   │   │   ├── 000008.sst
        │   │   │   ├── CURRENT
        │   │   │   ├── MANIFEST-000007
        │   │   │   └── OPTIONS-000005
        │   │   └── wal
        │   │       ├── <span style=color:#ae81ff>1</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>2</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>3</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>4</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>5</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>6</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>7</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       ├── <span style=color:#ae81ff>8</span>
        │   │       │   └── 0000000000000000233.wal
        │   │       └── <span style=color:#ae81ff>9</span>
        │   │           └── 0000000000000000233.wal
        │   └── SNAPSHOT_2019_12_04_10_54_44
        │       ├── data
        │       │   ├── 000006.sst
        │       │   ├── 000008.sst
        │       │   ├── 000009.sst
        │       │   ├── CURRENT
        │       │   ├── MANIFEST-000007
        │       │   └── OPTIONS-000005
        │       └── wal
        │           ├── <span style=color:#ae81ff>1</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>2</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>3</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>4</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>5</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>6</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>7</span>
        │           │   └── 0000000000000000236.wal
        │           ├── <span style=color:#ae81ff>8</span>
        │           │   └── 0000000000000000236.wal
        │           └── <span style=color:#ae81ff>9</span>
        │               └── 0000000000000000236.wal
        ├── data
</code></pre></div><h2 id=3-logic-analysis-processing>3. Logic Analysis Processing</h2><p><img src=https://user-images.githubusercontent.com/38887077/75141584-3b1aa180-572c-11ea-93b6-78fdc1e6874a.png alt=image></p><p>The <code>CREATE SNAPSHOT</code> is triggered with the client api or the console. The graph server parses the AST of the <code>CREATE SNAPSHOT</code> and sends the creation request to the meta server via the meta client. After receiving the request, the meta server first obtains all the active hosts and creates requests required by the adminClient. The creation requests are sent to each storage engine through the adminClient. After receiving the requests, the storage engine traverses all the storage engines of the specified spaces and creates checkpoint, then hard links the wals of all the partitions in storage engine. When creating checkpoint and the wal hard links, the database is read-only because the <code>write blocking</code> requests have been sent to all the leader partitions in advance.</p><p>Because the snapshot names are generated automatically with the system timestamp, you do not need to worry about renaming the snapshots. If you created unnecessary snapshots, you can delete them with the <code>DROP SNAPSHOT</code> command.</p><h3 id=31-create-snapshot>3.1 Create Snapshot</h3><p><img src=https://user-images.githubusercontent.com/56643819/70290076-c1040c00-1811-11ea-88dd-d66eb2e47ddf.png alt=image></p><h3 id=32-create-checkpoint>3.2 Create Checkpoint</h3><p><img src=https://user-images.githubusercontent.com/56643819/70290079-c3fefc80-1811-11ea-86e3-fbe0ddcf3d19.png alt=image></p><h2 id=4-key-code-implementation>4. Key Code Implementation</h2><h3 id=41-create-snapshot>4.1 Create Snapshot</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>folly<span style=color:#f92672>::</span>Future<span style=color:#f92672>&lt;</span>Status<span style=color:#f92672>&gt;</span> AdminClient<span style=color:#f92672>::</span>createSnapshot(GraphSpaceID spaceId, <span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> name) {
    <span style=color:#75715e>// Get all the hosts of storage engine
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>auto</span> allHosts <span style=color:#f92672>=</span> ActiveHostsMan<span style=color:#f92672>::</span>getActiveHosts(kv_);
    storage<span style=color:#f92672>::</span>cpp2<span style=color:#f92672>::</span>CreateCPRequest req;
    
    <span style=color:#75715e>// Specify spaceId, creates a checkpoint for all graph spaces, list spaces 
</span><span style=color:#75715e></span>    <span style=color:#75715e>// is executed in the calling function
</span><span style=color:#75715e></span>    req.set_space_id(spaceId);
    
    <span style=color:#75715e>// Specify snapshot name, generated by the meta server timestamp
</span><span style=color:#75715e></span>    <span style=color:#75715e>// For example: SNAPSHOT_2019_12_04_10_54_44
</span><span style=color:#75715e></span>    req.set_name(name);
    folly<span style=color:#f92672>::</span>Promise<span style=color:#f92672>&lt;</span>Status<span style=color:#f92672>&gt;</span> pro;
    <span style=color:#66d9ef>auto</span> f <span style=color:#f92672>=</span> pro.getFuture();
    
    <span style=color:#75715e>// Send requests to all the storage engines via the getResponse interface
</span><span style=color:#75715e></span>    getResponse(allHosts, <span style=color:#ae81ff>0</span>, std<span style=color:#f92672>::</span>move(req), [] (<span style=color:#66d9ef>auto</span> client, <span style=color:#66d9ef>auto</span> request) {
        <span style=color:#66d9ef>return</span> client<span style=color:#f92672>-&gt;</span>future_createCheckpoint(request);
    }, <span style=color:#ae81ff>0</span>, std<span style=color:#f92672>::</span>move(pro), <span style=color:#ae81ff>1</span> <span style=color:#75715e>/*The snapshot operation only needs to be retried twice*/</span>);
    <span style=color:#66d9ef>return</span> f;
}
</code></pre></div><h3 id=42-create-checkpoint>4.2 Create Checkpoint</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>ResultCode NebulaStore<span style=color:#f92672>::</span>createCheckpoint(GraphSpaceID spaceId, <span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>string<span style=color:#f92672>&amp;</span> name) {
    <span style=color:#66d9ef>auto</span> spaceRet <span style=color:#f92672>=</span> space(spaceId);
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>ok(spaceRet)) {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>error</span>(spaceRet);
    }
    <span style=color:#66d9ef>auto</span> space <span style=color:#f92672>=</span> nebula<span style=color:#f92672>::</span>value(spaceRet);
    
    <span style=color:#75715e>// Traverse through all the StorageEngines in the space
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>&amp;</span> engine : space<span style=color:#f92672>-&gt;</span>engines_) {
        
        <span style=color:#75715e>// First create a checkpoint fot the storage engie
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>auto</span> code <span style=color:#f92672>=</span> engine<span style=color:#f92672>-&gt;</span>createCheckpoint(name);
        <span style=color:#66d9ef>if</span> (code <span style=color:#f92672>!=</span> ResultCode<span style=color:#f92672>::</span>SUCCEEDED) {
            <span style=color:#66d9ef>return</span> code;
        }
        
        <span style=color:#75715e>// Then hard link the last wal of all the partitions in the storage engine
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>auto</span> parts <span style=color:#f92672>=</span> engine<span style=color:#f92672>-&gt;</span>allParts();
        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>auto</span><span style=color:#f92672>&amp;</span> part : parts) {
            <span style=color:#66d9ef>auto</span> ret <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>-&gt;</span>part(spaceId, part);
            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>ok(ret)) {
                LOG(ERROR) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Part not found. space : &#34;</span> <span style=color:#f92672>&lt;&lt;</span> spaceId <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34; Part : &#34;</span> <span style=color:#f92672>&lt;&lt;</span> part;
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>error</span>(ret);
            }
            <span style=color:#66d9ef>auto</span> walPath <span style=color:#f92672>=</span> folly<span style=color:#f92672>::</span>stringPrintf(<span style=color:#e6db74>&#34;%s/checkpoints/%s/wal/%d&#34;</span>,
                                                      engine<span style=color:#f92672>-&gt;</span>getDataRoot(), name.c_str(), part);
            <span style=color:#66d9ef>auto</span> p <span style=color:#f92672>=</span> nebula<span style=color:#f92672>::</span>value(ret);
            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>p<span style=color:#f92672>-&gt;</span>linkCurrentWAL(walPath.data())) {
                <span style=color:#66d9ef>return</span> ResultCode<span style=color:#f92672>::</span>ERR_CHECKPOINT_ERROR;
            }
        }
    }
    <span style=color:#66d9ef>return</span> ResultCode<span style=color:#f92672>::</span>SUCCEEDED;
}
</code></pre></div><h2 id=5-user-guide>5. User Guide</h2><h3 id=51-create-snapshot>5.1 CREATE SNAPSHOT</h3><p>The <code>CREATE SNAPSHOT</code> command creates a snapshot at the current point in time for the whole cluster. The snapshot name is composed of the timestamp of the meta server.</p><p>If snapshot creation fails in the current version, you must use the <code>DROP SNAPSHOT</code> to clear the invalid snapshots. The current version does not support creating snapshot for the specified graph spaces, and executing <code>CREATE SNAPSHOT</code> creates a snapshot for all graph spaces in the cluster. For example:</p><pre><code class=language-ngql data-lang=ngql>nebula&gt; CREATE SNAPSHOT;
Execution succeeded (Time spent: 22892/23923 us)
</code></pre><h3 id=52-show-snapshots>5.2 Show Snapshots</h3><p>The command <code>SHOW SNAPSHOT</code> looks at the states (VALID or INVALID), names and the IP addresses of all storage servers when the snapshots are created in the cluster. For example:</p><pre><code class=language-ngql data-lang=ngql>nebula&gt; SHOW SNAPSHOTS;
===========================================================
| Name                         | Status | Hosts           |
===========================================================
| SNAPSHOT_2019_12_04_10_54_36 | VALID  | 127.0.0.1:77833 |
-----------------------------------------------------------
| SNAPSHOT_2019_12_04_10_54_42 | VALID  | 127.0.0.1:77833 |
-----------------------------------------------------------
| SNAPSHOT_2019_12_04_10_54_44 | VALID  | 127.0.0.1:77833 |
-----------------------------------------------------------
</code></pre><h3 id=53-delete-snapshot>5.3 Delete Snapshot</h3><p>The <code>DROP SNAPSHOT</code> command deletes a snapshot with the specified name, the syntax is:</p><pre><code class=language-ngql data-lang=ngql>DROP SNAPSHOT &lt;snapshot-name&gt;
</code></pre><p>You can get the snapshot names with the command <code>SHOW SNAPSHOTS</code>. <code>DROP SNAPSHOT</code> can delete both valid snapshots and invalid snapshots that failed during creation. For example:</p><pre><code class=language-ngql data-lang=ngql>nebula&gt; DROP SNAPSHOT SNAPSHOT_2019_12_04_10_54_36;
nebula&gt; SHOW SNAPSHOTS;
===========================================================
| Name                         | Status | Hosts           |
===========================================================
| SNAPSHOT_2019_12_04_10_54_42 | VALID  | 127.0.0.1:77833 |
-----------------------------------------------------------
| SNAPSHOT_2019_12_04_10_54_44 | VALID  | 127.0.0.1:77833 |
-----------------------------------------------------------
</code></pre><p>Now the deletes snapshot is not in the show snapshots list.</p><h2 id=6-tips>6. Tips</h2><ul><li>When the system structure changes, it is better to create a snapshot immediately. For example, when you add host, drop host, create space, drop space or balance.</li><li>The current version does not support automatic garbage collection for the failed snapshots in creation. We will develop cluster checker in meta server to check the cluster state via asynchronous threads and automatically collect the garbage files in failure snapshot creation.</li><li>The current version does not support customized snapshot directory. The snapshots are created in the <code>data_path/nebula</code> directory by default.</li><li>The current version does not support snapshot restore. Users need to write a shell script based on their actual productions to restore snapshots. The implementation logic is rather simple, you copy the snapshots of the engine servers to the specified folder, set this folder to <code>data_path/</code>, then start the cluster.</li></ul><h2 id=you-might-also-like>You might also like</h2><ol><li><a href=https://nebula-graph.io/en/posts/clean-stale-data-with-ttl-in-nebula-graph/>How Nebula Graph Automatically Cleans Stale Data with TTL</a></li><li><a href=https://nebula-graph.io/en/posts/how-indexing-works-in-nebula-graph/>How Indexing Works in Nebula Graph</a></li><li><a href=https://nebula-graph.io/en/posts/nebula-graph-storage-banlancing-data-migration/>Storage Balance and Data Migration</a></li></ol><blockquote class=star-ads><span>Like what we do ? Star us on GitHub.</span>
<a href=https://github.com/vesoft-inc/nebula onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'Star via blogbody'});">https://github.com/vesoft-inc/nebula</a></blockquote><ul class=blog-footer><li><img src=/images/tag.png>
<a href=/nebula-website/en/tags/features>features</a></li><li class="nebula-share st-btn"><img src=/images/share.png>
<span>Share Post</span><ul class=blog-footer-share-links><li class=st-custom-button data-network=twitter><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/twitter-white.svg>
<span class=st-label>Twitter</span></li><li class=st-custom-button data-network=linkedin><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/linkedin-white.svg>
<span class=st-label>Linkedin</span></li><li class=st-custom-button data-network=facebook><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/facebook-white.svg>
<span class=st-label>Facebook</span></li><li class=st-custom-button data-network=sharethis><img alt="twitter-white sharing button" src=https://platform-cdn.sharethis.com/img/sharethis-white.svg>
<span class=st-label>Others</span></li></ul></li><li onclick="location.href='\/nebula-website\/en\/posts'"><img src=/images/blog.png>
<a href=/nebula-website/en/posts>Back to blog home</a></li><li onclick="gtag('event','Link Click',{event_category:'Engagement',event_label:'RSS on sidebar'});window.open('https:\/\/nebula-graph.io/en/posts/index.xml');"><img src=/images/rss.png>
<a href=javascript:void(0);>RSS</a></li></ul><div id=discourse-comments></div></section><div class=single-side-bar><div class=tags-block><h3><img src=/img/LabelTagIcon.png>Tags</h3><ul class=blog-tags><li class=col-md-12><a href=/nebula-website/en/posts class=active>all</a></li><li><a href=/nebula-website/en/tags/architecture>architecture</a></li><li><a href=/nebula-website/en/tags/community>community</a></li><li><a href=/nebula-website/en/tags/deployment>deployment</a></li><li><a href=/nebula-website/en/tags/dev-log>dev-log</a></li><li><a href=/nebula-website/en/tags/features class=active>features</a></li><li><a href=/nebula-website/en/tags/graph-database>graph-database</a></li><li><a href=/nebula-website/en/tags/performance>performance</a></li><li><a href=/nebula-website/en/tags/query-language>query-language</a></li><li><a href=/nebula-website/en/tags/release-notes>release-notes</a></li><li><a href=/nebula-website/en/tags/system-testing>system-testing</a></li><li><a href=/nebula-website/en/tags/tools>tools</a></li><li><a href=/nebula-website/en/tags/use-cases>use-cases</a></li></ul></div><div class=blog-anchors id=J_Anchor><h3>Contents</h3><nav id=TableOfContents><ul><li><a href=#1-overview>1. Overview</a><ul><li><a href=#11-terms>1.1 Terms</a></li><li><a href=#12-background>1.2 Background</a></li></ul></li><li><a href=#2-architecture>2. Architecture</a><ul><li><a href=#21-architecture-overview>2.1 Architecture Overview</a></li><li><a href=#22-storage-system-structure>2.2 Storage System Structure</a></li><li><a href=#23-storage-system-file-structure>2.3 Storage System File Structure</a></li></ul></li><li><a href=#3-logic-analysis-processing>3. Logic Analysis Processing</a><ul><li><a href=#31-create-snapshot>3.1 Create Snapshot</a></li><li><a href=#32-create-checkpoint>3.2 Create Checkpoint</a></li></ul></li><li><a href=#4-key-code-implementation>4. Key Code Implementation</a><ul><li><a href=#41-create-snapshot>4.1 Create Snapshot</a></li><li><a href=#42-create-checkpoint>4.2 Create Checkpoint</a></li></ul></li><li><a href=#5-user-guide>5. User Guide</a><ul><li><a href=#51-create-snapshot>5.1 CREATE SNAPSHOT</a></li><li><a href=#52-show-snapshots>5.2 Show Snapshots</a></li><li><a href=#53-delete-snapshot>5.3 Delete Snapshot</a></li></ul></li><li><a href=#6-tips>6. Tips</a></li><li><a href=#you-might-also-like>You might also like</a></li></ul></nav></div></div></div><img onclick="location.href='#top'" class=go-ahead src=/images/up.png></div><footer class="container-fluid foot-wrap" name=contact_us><div class=container><div class=row><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Community</h3><ul><li><img src=/img/github.png>
<a href=https://github.com/vesoft-inc/nebula target=_blank>GitHub</a></li><li><img src=/img/forum.png>
<a href=https://discuss.nebula-graph.io/ target=_blank>Forum</a></li><li><img src=/img/slack.png>
<a href=https://join.slack.com/t/nebulagraph/shared_invite/enQtNjIzMjQ5MzE2OTQ2LTM0MjY0MWFlODg3ZTNjMjg3YWU5ZGY2NDM5MDhmOGU2OWI5ZWZjZDUwNTExMGIxZTk2ZmQxY2Q2MzM1OWJhMmY# target=_blank>Slack</a></li></ul></div><div class="row-content col-lg-4 col-sm-4 col-xs-4"><h3>Follow Us</h3><ul><li><img src=/img/twitter.png>
<a href=https://twitter.com/NebulaGraph title=Twitter data-toggle=modal target=_blank data-target>Twitter</a></li><li><img src=/img/linkedin.png>
<a href=https://www.linkedin.com/company/vesoft-nebula-graph/ title=LinkedIn data-toggle=modal target=_blank data-target>LinkedIn</a></li><li><img src=/img/youtube.png>
<a href=https://www.youtube.com/channel/UC73V8q795eSEMxDX4Pvdwmw title=YouTube data-toggle=modal target=_blank data-target>YouTube</a></li><li><img src=/img/facebook.png>
<a href=https://www.facebook.com/NebulaGraph/ title=FaceBook data-toggle=modal target=_blank data-target>FaceBook</a></li><li><img src=/img/weibo.png>
<a href=https://weibo.com/nebulagraph title=WeiBo data-toggle=modal target=_blank data-target>WeiBo</a></li><li><img src=/img/gongzhonghao.png>
<a href title="Official Accounts" data-toggle=modal target=_blank data-target=#myGongzhonghaoModal>Official Accounts</a></li></ul></div><div class="contactus row-content col-lg-4 col-sm-4 col-xs-4"><h3>Contact Us</h3><ul><li><img src=/img/iphone.png>
<a href data-toggle=modal target=_blank data-target>(+86) 0571-28120658</a></li><li><img src=/img/email.png>
<a href=mailto:info@vesoft.com data-toggle=modal target=_blank data-target>info@vesoft.com</a></li><li><img src=/img/weixin.png>
<a href data-toggle=modal target=_blank data-target=#myModal>WeChat</a></li></ul></div></div></div><p align=left style=font-size:16px><img src=/images/VEsoft.png style=margin-right:10px> Copyright &copy;2020 VESoft Inc</p><div class="modal fade" id=myGongzhonghaoModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/gonggonghaoCODE.jpg></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div><div class="modal fade" id=myModal tabindex=-1 role=dialog aria-labelledby=myModalLabel aria-hidden=true><div class=modal-dialog><div class=modal-content><div class="modal-body wechat"><img src=/images/wechat.png></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>close</button></div></div></div></div></footer></main><div id=J_Star_Popup class=nebula-star-popup></div><script src=/nebula-website/js/jquery.js></script><script src=/nebula-website/js/bootstrap.min.js></script><script src=/nebula-website/js/jquery.easing.min.js></script><script src=/nebula-website/js/jquery.fittext.js></script><script src=/nebula-website/js/wow.min.js></script><script type=text/javascript src="https://platform-api.sharethis.com/js/sharethis.js#property=5e7c2cc315c7990012ae38bc&product=inline-share-buttons" async></script><script src=/nebula-website/js/creative.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script src=/nebula-website/js/init.js></script><script type=text/javascript>DiscourseEmbed={discourseUrl:'https://discuss.nebula-graph.io/',discourseEmbedUrl:"\/nebula-website\/en\/posts\/nebula-graph-snapshot-introduction\/"};(function(){var d=document.createElement('script');d.type='text/javascript';d.async=true;d.src=DiscourseEmbed.discourseUrl+'javascripts/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(d);})();</script><script src=/nebula-website/js/anchor.js></script></body></html><script>if(!sessionStorage.getItem("popupIsRemove")){$("#top").css("padding-top","98px")}</script>